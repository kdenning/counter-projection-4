---
title: "Counter Projection 4 Analyses"
author: "Kathryn Denning"
date: "1/20/2021"
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
editor_options: 
  chunk_output_type: console
---

652 participants originally collected from Prolific Academic
3 had empty data lines = 649 in imported dataset

```{r data prep, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
#loading packages
library(foreign)
library(reshape2)
library(tidyverse)
library(dplyr)
library(car)
library(haven)
library(psych)
library(lmerTest)
library(sjPlot)
library(reshape2)
library(data.table)
library(emmeans)
library(effects)
library(Cairo)
library(tinytex)
library(magrittr)

#making it round to three decimal places
options(scipen = 999)
knitr::opts_knit$set(dev.args = list(type = "cairo"))

#Setting global chunk options
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

#importing the data that has been reviewed for completion of PT task
wide_data <- Import("data_downloaded_January_20_2021.csv") 
```

```{r bot check, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Checking if there are any repeat IP addresses that need removed
bot_check  <- wide_data %>% 
  select(sub_id, IPAddress)

#identifying the repeat IP addresses
repeat_ips <- bot_check$IPAddress[duplicated(bot_check$IPAddress)]

# There are none - as expected using Prolific
```

```{r data cleaning}
clean_data <- wide_data %>% 
  # reverse coding items that need reverse coded
  mutate_at(c("selfBFI_1", "selfBFI_7", "selfBFI_3", "selfBFI_8",
              "selfBFI_14", "selfBFI_10", "selfBFI_17", "selfBFI_18",
              "SterBFIAnti_1", "SterBFIAnti_7", "SterBFIAnti_3",
              "SterBFIAnti_8", "SterBFIAnti_14", "SterBFIAnti_10",
              "SterBFIAnti_17", "SterBFIAnti_18", "SterBFITrump_1",
              "SterBFITrump_7", "SterBFITrump_3", "SterBFITrump_8",
              "SterBFITrump_14", "SterBFITrump_10", "SterBFITrump_17",
              "SterBFITrump_18", "TargBFITrump_1", "TargBFITrump_7",
              "TargBFITrump_3", "TargBFITrump_8", "TargBFITrump_14",
              "TargBFITrump_10", "TargBFITrump_17", "TargBFITrump_18",
              "TargBFIAnti_1", "TargBFIAnti_7", "TargBFIAnti_3", 
              "TargBFIAnti_8", "TargBFIAnti_14", "TargBFIAnti_10",
              "TargBFIAnti_17", "TargBFIAnti_18"), 
               list(~dplyr::recode(., `1`= 5, 
                                   `2`= 4, 
                                   `3` = 3, 
                                   `4` = 2, 
                                   `5` = 1))) %>% 
  # get their two chances to answer about their opinion in the same column
  pivot_longer(c(opin_pol, opin_pol2)) %>% 
  mutate(opin_pol_combined = value) %>% 
  dplyr::select(-value, -name) %>% 
  filter(!is.na(opin_pol_combined)) %>% 
  # get the BFI scores used for projection in long-format
  pivot_longer(c(SterBFIAnti_1:SterBFIAnti_19,
               SterBFITrump_1:SterBFITrump_19,
               TargBFITrump_1:TargBFITrump_19,
               TargBFIAnti_1:TargBFIAnti_19,
               selfBFI_1:selfBFI_19),
               names_sep = "_",
               names_to = c("bfi_type", "BFI_number")) %>% 
  pivot_wider(names_from = bfi_type, values_from = value) %>% 
  # wrangle to remove NA's from target, since participants only got one target
  pivot_longer(c(TargBFITrump, TargBFIAnti),
              names_to = "BFI_target_group") %>% 
  mutate_at(vars(value), ~replace(., is.na(.), 99)) %>% 
  filter(value != "99") %>% 
  rename(TargBFI = value) %>% 
  # create column for target group for BFI
  mutate(BFI_target_group = (dplyr::recode(BFI_target_group, 
                                           `TargBFITrump`= "Trump",
                                           `TargBFIAnti`= "Anti"))) %>% 
  # get everyday responses in long format
  pivot_longer(c(SterEDAnti_1:SterEDAnti_5,
               SterEDTrump_1:SterEDTrump_5,
               TargEDTrump_1:TargEDTrump_5,
               TargEDAnti_1:TargEDAnti_5,
               selfED_1:selfED_5),
               names_sep = "_",
               names_to = c("ed_type", "ED_number")) %>% 
  pivot_wider(names_from = ed_type, values_from = value) %>% 
  # also need to wrangle to remove NA's due to one target per participant
  pivot_longer(c(TargEDTrump, TargEDAnti),
               names_to = c("ED_targ_group")) %>% 
  mutate_at(vars(value), ~replace(., is.na(.), 99)) %>% #to remove NA's using filtering, making them 99's first, since filter wasn't letting me filter "NA"
  filter(value != "99") %>% 
  rename(TargED = value) %>% #renaming "value" to keep the variable
  # target per everyday responses and making variables factors or numeric
  mutate(ED_targ_group = (dplyr::recode(ED_targ_group, 
                                        `TargEDTrump`= "Trump",
                                        `TargEDAnti`= "Anti")),
         group_cond = as.factor(ifelse(opin_pol_combined == 1 #1 means "yes" they supported Trump's 2020 bid for re-relection
                             & BFI_target_group == "Trump", 
                             "In-group",
                             ifelse(opin_pol_combined == 2 #2 means "no" they did not support Trump's re-election
                                    & BFI_target_group == "Trump", 
                                    "Out-group",
                                    ifelse(opin_pol_combined == 1 
                                           & BFI_target_group == "Anti", 
                                           "Out-group",
                                           ifelse(opin_pol_combined == 2 
                                                  & BFI_target_group == "Anti", 
                                                  "In-group", NA))))),
         ED_number = as.numeric(ED_number),
         BFI_number = as.numeric(BFI_number),
         ED_targ_group = as.factor(ED_targ_group),
         BFI_target_group = as.factor(BFI_target_group),
         opin_pol_combined = as.factor(opin_pol_combined),
         race = as.factor(race),
         gender = as.factor(gender),
         education = as.factor(education),
         parent_education = as.factor(parent_education),
         country_birth = as.factor(country_birth),
         native_language = as.factor(native_language),
         citizen = as.factor(citizen),
         us_location = as.factor(us_location)) %>% 
  # dropping unnecessary text variables
  select(-c(day_nosupport_targ, day_support_trump_targ, gender_3_TEXT,
            race_8_TEXT, country_birth_2_TEXT, country_raised_2_TEXT,
            native_language_2_TEXT, IPAddress)) %>% 
  # making one variable for the following variables depending on which target (supported Trump vs did not) participants saw for both BFI and ED scales
  mutate(stereoBFI = ifelse(BFI_target_group == "Trump", SterBFITrump,
                             ifelse(BFI_target_group == "Anti", SterBFIAnti, 
                                    NA)),
         stereoED = ifelse(ED_targ_group == "Trump", SterEDTrump,
                           ifelse(ED_targ_group == "Anti", SterEDAnti, NA)),
         # making one for each of these individual differences collapses across who the participant supported in the election
         contentiousness = ifelse(opin_pol_combined == 1, 
                                  cont_pol_trump,
                                  ifelse(opin_pol_combined == 2, 
                                         cont_pol_antitrump, NA)),
         fundaMoral = ifelse(opin_pol_combined == 1, 
                             fund_pol_trump,
                                  ifelse(opin_pol_combined == 2, 
                                         fund_pol_antitrump, NA)),
         polar_lib = ifelse(opin_pol_combined == 1, 
                            lib_pol_trump_8,
                                  ifelse(opin_pol_combined == 2, 
                                         lib_pol_antitrump_8, NA)),
         polar_cons = ifelse(opin_pol_combined == 1, 
                             cons_pol_antitrump_8,
                                  ifelse(opin_pol_combined == 2, 
                                         cons_pol_antitrump_8, NA)),
         threat = ifelse(opin_pol_combined == 1, 
                         threat_pol_trump,
                                  ifelse(opin_pol_combined == 2, 
                                         threat_pol_antitrump, NA)),
         identification = ifelse(opin_pol_combined == 1, 
                                 ident_pol_trump,
                                  ifelse(opin_pol_combined == 2, 
                                         ident_pol_antitrump, NA)),
         # making manipulation checks all have the same levels so they can be combined to avoid NA's and used to filter out participants; keeping participants who got either qcheck 1 or 2 for the same question right
         qcheck_bfi_anti_total = ifelse(qcheck_bfi_notsupport == 2, 1,
                                        ifelse(qcheck2_bfi_notsupport == 2, 1,
                                               ifelse(qcheck_bfi_notsupport == 1, 2, #recoding so 1 = include and 2 = exclude
                                                      ifelse(qcheck_bfi_notsupport == 3, 2, NA)))),
         qcheck_bfi_trump_total = ifelse(qcheck_bfi_trump == 1, 1,
                                         ifelse(qcheck2_bfi_trump == 1, 1,
                                                ifelse(qcheck_bfi_trump == 2, 2,
                                                       ifelse(qcheck_bfi_trump == 3, 2, NA)))),
         qcheck_targ_trump_total = ifelse(qcheck_targ_trump == 1, 1,
                                          ifelse(qcheck2_targ_trump == 1, 1,
                                                 ifelse(qcheck_targ_trump == 2, 2, NA))),
         qcheck_targ_anti_total = ifelse(qcheck_targ_nosupport == 2, 1, #recoding so 1 = include, 2 = exclude
                                         ifelse(qcheck2_targ_nosupport == 2, 1,
                                                ifelse(qcheck_targ_nosupport == 1, 2, NA)))) %>% 
  # dropping variables no longer needed after creating new variables above
  select(-c(cont_pol_trump, cont_pol_antitrump, fund_pol_trump, 
            fund_pol_antitrump, lib_pol_trump_8, lib_pol_antitrump_8,
            cons_pol_antitrump_8, cons_pol_antitrump_8, threat_pol_trump,
            threat_pol_antitrump, ident_pol_trump, ident_pol_antitrump, consent,
            qcheck_bfi_notsupport, qcheck2_bfi_notsupport, qcheck2_bfi_trump,
            qcheck_bfi_trump, qcheck_targ_trump, qcheck2_targ_trump,
            qcheck_targ_nosupport, qcheck2_targ_nosupport,
            opin_pol_lastchance, cons_pol_trump_8)) %>% 
  filter(qcheck_bfi_anti_total == 1) %>% # only keeping participants who got manipulation check for the bfi anti trump right
  filter(qcheck_bfi_trump_total == 1) %>% # same as above but for bfi supporting target
  # putting the qcheck for targets together to avoid NAs, removing NAs, then only keeping correct responses
  pivot_longer(c(qcheck_targ_trump_total, qcheck_targ_anti_total),
               names_to = c("qcheck_question")) %>% 
  mutate_at(vars(value), ~replace(., is.na(.), 99)) %>% #same process as above for filtering NA's
  filter(value != "99") %>% 
  filter(value == 1) %>% 
  rename(qcheck_targ = value) %>% 
  filter(citizen == 1)  %>% # only keeping people who are US citizens because study on US politics
  mutate(perceive_polar = abs(polar_lib - polar_cons)) %>% #getting variable for perceived polar by subtracting perceived polarization for conservatives from liberals and getting teh absolute value of that diff
  # centering predictors - will wait to center exploratory predictors until after EFA
  mutate(selfBFI_c = selfBFI - mean(selfBFI, na.rm = TRUE),
         selfED_c = selfED - mean(selfED, na.rm = TRUE),
         stereoBFI_c = stereoBFI - mean(stereoBFI, na.rm = TRUE),
         stereoED_c = stereoED - mean(stereoED, na.rm = TRUE),
         identification_c = identification - mean(identification, na.rm = TRUE))

#opin_pol: Do you support Trump? 1 = yes; 2 = no; same in follow-up question
# for qcheck not support bfi, 2 is correct; originally
# for qcheck for trump bfi, 1 is correct; originally
# for qcheck for trump targ, 1 is correct; originally
# for qcheck for anti targ, 2 is correct; originally

clean_ptcheck <- clean_data %>% 
  filter(questionable_pt == 1) # only keeping people who completed the PT task correctly
```

# Demographics

## Sample Size

```{r n}
clean_ptcheck %>% 
  select(sub_id) %>% 
  unique() %>% 
  nrow()
```

## N per conditions

### In/out-group

```{r n by group cond}
clean_ptcheck %>% 
  select(sub_id, group_cond) %>% 
  unique() %>% 
  group_by(group_cond) %>% 
  count()

```

### Group & voting opinion

```{r n by group and voting opin}
clean_ptcheck %>% 
  select(sub_id, group_cond, opin_pol_combined) %>% 
  unique() %>% 
  mutate(opin_pol_combined = dplyr::recode(opin_pol_combined,
                                    `1` = "Trump supporter",
                                    `2` = "Anti Trump")) %>% 
  group_by(group_cond, opin_pol_combined) %>% 
  count()
```

## Gender

```{r gender}
clean_ptcheck %>% 
  na.omit() %>% 
  select(sub_id, gender) %>% 
  mutate(gender = dplyr::recode(gender, 
                         `1` = "Male",
                         `2` = "Female",
                         `3` = "Other")) %>% 
  unique() %>% 
  group_by(gender) %>% 
  count()
```

## Race

```{r race}
race_counts <- clean_ptcheck %>% 
  select(sub_id, race) %>% 
  na.omit() %>% 
  mutate(race = dplyr::recode(race, 
                       `1` = "American Indian/Alaska Native",
                       `2` = "Asian",
                       `3` = "Black",
                       `4` = "Latinx",
                       `5` = "Middle Eastern/North African",
                       `6` = "Caucasian",
                       `7` = "Multiracial",
                       `8` = "Other")) %>% 
  unique() %>% 
  group_by(race) %>% 
  count()

race_counts %>% 
  mutate(n_total = sum(race_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Age

```{r age}
clean_ptcheck %>% 
  select(sub_id, age) %>% 
  na.omit() %>% 
  summarize(mean = mean(age),
            sd = sd(age))
```

## Education

```{r participant education}
edu_counts <- clean_ptcheck %>% 
  select(sub_id, education) %>% 
  na.omit() %>% 
  mutate(education = dplyr::recode(education,
                                     `1` = "Less than high school",
                                     `2` = "High school graduate",
                                     `3` = "Some college",
                                     `4` = "Associate's degree",
                                     `5` = "Bachelor's degree",
                                     `6` = "Some graduate school",
                                     `7` = "Master's degree",
                                     `8` = "Doctorate or Professional Degree")) %>% 
  unique() %>% 
  group_by(education) %>% 
  count()

edu_counts %>% 
  mutate(n_total = sum(edu_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Parent Edu

```{r parent education}
pedu_counts <- clean_ptcheck %>% 
  select(sub_id, parent_education) %>% 
  na.omit() %>% 
  mutate(education = dplyr::recode(parent_education,
                                     `20` = "Less than high school",
                                     `21` = "High school graduate",
                                     `22` = "Some college",
                                     `23` = "Associate's degree",
                                     `24` = "Bachelor's degree",
                                     `26` = "Some graduate school",
                                     `1` = "Master's degree",
                                     `2` = "Doctorate or Professional Degree")) %>% 
  unique() %>% 
  group_by(education) %>% 
  count()

pedu_counts %>% 
  mutate(n_total = sum(edu_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Birth country

*All participants are US citizens.*

```{r birth country}
# All are US citizens in this current study
clean_ptcheck %>% 
  select(sub_id, country_birth) %>% 
  na.omit() %>% 
  mutate(country_birth = dplyr::recode(country_birth,
                                      `1` = "US born",
                                      `2` = "Foreign born")) %>% 
  unique() %>% 
  group_by(country_birth) %>% 
  count()
```

## Country raised

```{r country raised}
# All are US citizens in this current study
clean_ptcheck %>% 
  select(sub_id, country_raised) %>% 
  na.omit() %>% 
  mutate(country_raised = dplyr::recode(country_raised,
                                      `1` = "US raised",
                                      `2` = "Foreign raised")) %>% 
  unique() %>% 
  group_by(country_raised) %>% 
  count()
```

## Native lang

```{r native language}
# All are US citizens in this current study
clean_ptcheck %>% 
  select(sub_id, native_language) %>% 
  na.omit() %>% 
  mutate(native_language = dplyr::recode(native_language,
                                      `1` = "English",
                                      `2` = "Foreign language")) %>% 
  unique() %>% 
  group_by(native_language) %>% 
  count()
```

## Overall political beliefs

Question: Overall, where would you place yourself, on the following scale of liberalism to conservatism?
1 indicates "Very liberal" and 5 indicates "Very conservative"

### Across group:

```{r histo of overall political leanings}
hist_pol_overall <- clean_ptcheck %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall$poli_orient_1)
```

### In-group:

```{r histo of overall political leanings in-group}
hist_pol_overall_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_in$poli_orient_1)
```

### Out-group:

```{r histo of overall political leanings out-group}
hist_pol_overall_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_out$poli_orient_1)
```

## Social political beliefs

Question: In terms of social and cultural issues (e.g., abortion, separation of church and state, affirmative action), where would you place yourself on the following scale? 
1 indicates "Very liberal" and 5 indicates "Very conservative"

### Across group:

```{r histo of social political leanings}
hist_pol_social <- clean_ptcheck %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social$poli_orient_2)
```

### In-group:

```{r histo of social political leanings in-group}
hist_pol_social_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_in$poli_orient_2)
```

### Out-group:

```{r histo of social political leanings out-group}
hist_pol_social_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_out$poli_orient_2)
```

## Economic political beliefs

Question: In terms of economic issues (e.g., taxation, welfare, privatization of social security), where would you place yourself on the following scale? 
1 indicates "Very liberal" and 5 indicates "Very conservative"

### Across group:

```{r histo of econ political leanings}
hist_pol_econ <- clean_ptcheck %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ$poli_orient_3)
```

### In-group:

```{r histo of econ political leanings in-group}
hist_pol_econ_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_in$poli_orient_3)
```

### Out-group:

```{r histo of econ political leanings out-group}
hist_pol_econ_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_out$poli_orient_3)
```

## Political knowledge

Question: Which party has the most members in the U.S. House of Representatives in Washington, D.C.?

*This data was collected in October 2020, when the House was Democratic*

```{r house correct}
clean_ptcheck %>% 
  select(sub_id, house_most_members) %>% 
  na.omit() %>% 
  unique() %>% 
  mutate(house_most_members = dplyr::recode(house_most_members,
                                            `2` = "Democrat control",
                                            `6` = "Republican control",
                                            `3` = "Do not know")) %>% 
  group_by(house_most_members) %>% 
  count()
```

This question shows that 114 people answered incorrectly and 104 did not know. Political knowledge and extreme political beliefs (how liberal or conservative someone is) could impact results and could be used as an exploratory moderator.

```{r}
clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined)  %>% 
  unique() %>% 
  count()

# how unique numbers of datapoints change when we remove na's in long-format
clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined)  %>% 
  na.omit() %>% 
  unique() %>% 
  count()
```

# Pre-reg Mod 1: Projection by group w/ BFI

```{r model 1 data}
model1_data <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined) %>% 
  na.omit() %>% 
  unique()
```

**Getting effects coding for target group:**

```{r}
contrasts(model1_data$group_cond) <- contr.sum(2)
contrasts(model1_data$group_cond)
````

```{r model 1 results}
model1 <- lmer(TargBFI ~ selfBFI_c*group_cond + (selfBFI_c|sub_id),
               data = model1_data)
summary(model1)
```

### Plot: ME target group

```{r model 1 prep main effect group}
mod1_proj_group <- effect(term = "selfBFI_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model1)

mod1_proj_group <- as.data.frame(mod1_proj_group)
```

```{r Model 1 main effect group plot}
ggplot(mod1_proj_group, aes(selfBFI_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Plot from Model 1: Main effect of target group on projection",
       subtitle = "Projection using BFI",
         x = "Personality responses for self",
         y = "Personality responses for target")
```

We replicate our prior finding that people counter project with their political out-group, but project positively with their political in-group target.

This supports Confirmatory Prediction #1: "People will counter-project to a target person from their political out-group and project to a target person from their in-group."

# Hierachial build-up to Pre-reg Mod 2

## Adding Everyday Likes (ED)

```{r model 2 ED data}
model2ED_data <- clean_ptcheck %>% 
  select(sub_id, ED_number, TargED, selfED_c, group_cond, 
         opin_pol_combined, stereoED_c) %>% 
  na.omit() %>% 
  unique()
```

**Getting effects coding for target group:**

```{r}
contrasts(model2ED_data$group_cond) <- contr.sum(2)
contrasts(model2ED_data$group_cond)
````

### ED without stereotyping in model

```{r model 2 ED results not pre-reg}
model2ED_notpr <- lmer(TargED ~ selfED_c*group_cond+ (selfED_c|sub_id),
               data = model2ED_data)
summary(model2ED_notpr)
```

#### Plot: ME target group

```{r model 2 ED prep main effect group}
mod2ED_proj_group <- effect(term = "selfED_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model2ED_notpr)

mod2ED_proj_group <- as.data.frame(mod2ED_proj_group)
```

```{r Model 2 ED main effect group plot}
ggplot(mod2ED_proj_group, aes(selfED_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using 'Everyday Likes' (ED) items before stereotyping added",
         x = "ED items for self",
         y = "ED items for target")
```

### ED w/ stereotyping in model

```{r model 2 ED results, warning = FALSE, message = FALSE, error = FALSE}
model2EDwstereo <- lmer(TargED ~ selfED_c*group_cond*stereoED_c + (1|sub_id),
               data = model2ED_data)
summary(model2EDwstereo)
```

Running it on its own with stereotyping (which Model 2 includes adding both ED and stereotyping at once) does not converge. Most likely due to too few items nested within the higher level for so many variables and not enough variance between the two.

We removed random slopes for the selfED_c predictor and then the model converged. We looked at the impact of removing this random slope in models for the everyday likes without stereotyping and BFI with stereotyping and found it did not have an impact on results.

#### Plot: ME target group

```{r model 2 ED prep main effect group with stereo}
mod2ED_proj_group_wstereo <- effect(term = "selfED_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model2EDwstereo)

mod2ED_proj_group_wstereo <- as.data.frame(mod2ED_proj_group_wstereo)
```

```{r Model 2 ED main effect group plot with stereo}
ggplot(mod2ED_proj_group_wstereo, aes(selfED_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using ED likes items controlling for stereotyping",
         x = "ED items for self",
         y = "ED items for target")
```

## BFI only with stereo

```{r model 2 bfi stereo data}
model2_bfistereo <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined, stereoBFI_c) %>% 
  na.omit() %>% 
  unique()
```

**Getting effects coding for target group:**

```{r contrast codes model 2 bfi stereo}
contrasts(model2_bfistereo$group_cond) <- contr.sum(2)
contrasts(model2_bfistereo$group_cond)
```

```{r model 2 bfi stereo results}
model2_bfistereo_resuts <- lmer(TargBFI ~ selfBFI_c*group_cond*stereoBFI_c + (selfBFI_c|sub_id), data = model2_bfistereo)

summary(model2_bfistereo_resuts)
```

The main effect of selfBFI_c:group_condOut-group did not disappear when including stereotyping as a moderator, replicating the exploratory results from Study 1 (my FYP), and there was no interaction of stereotyping*target group on projection. However, there is a three-way interaction that we need to consider, and we need to consider how the plots look.

### Plot: ME target group

```{r model 2 prep main effect group}
model2_bfistereo_group_effects <- effect(term = "selfBFI_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model2_bfistereo_resuts)

model2_bfistereo_group_effects <- as.data.frame(model2_bfistereo_group_effects)
```

```{r Model 3 main effect group plot}
ggplot(model2_bfistereo_group_effects, aes(selfBFI_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 2: Main effect of target group on projection using BFI",
       subtitle = "Controlling for stereotyping",
         x = "Personality responses for self",
         y = "Personality responses for target")
```

When controlling for stereotyping, the counter projection found earlier does disappear.

### Plot: stereo x group int

```{r model 2 interaction with stereo prep}
describe(model2_bfistereo$stereoBFI_c)

model2_bfistereo_int_effects <- effect(term = "selfBFI_c:group_cond:stereoBFI_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"), 
                                         stereoBFI_c = c(-1.22, 0, 1.22)), 
                           mod = model2_bfistereo_resuts)

model2_bfistereo_int_effects <- as.data.frame(model2_bfistereo_int_effects)

model2_bfistereo_int_effects %<>% 
  mutate(Stereotyping = as.factor(stereoBFI_c),
         Stereotyping = dplyr::recode(Stereotyping,
                                      `-1.22` = 
                                        "Low stereotyping \n (1 SD below)",
                                      `0` = 
                                        "Average stereotyping",
                                      `1.22` = 
                                        "High stereotyping  \n(1 SD above)"))
```

```{r model 2 interaction plot with stereo}
ggplot(model2_bfistereo_int_effects, aes(selfBFI_c, 
                                     fit, 
                                     group = group_cond,
                                     colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_grid(cols = vars(Stereotyping)) +
  theme_minimal() +
  theme(legend.title = element_blank()) +
  labs(title = "Model 2: Projection by stereotype use and group membership",
       subtitle = "Using BFI only - not explicitly pre-registered",
       x = "Personality traits for self",
       y = "Personality traits for target")
```

It appears that as stereotype use increases, the intercept for projection for both in-group and out-group increases and the difference between groups increases as well. People are projecting more for their in-group when they stereotype the least, but also appear to be projecting less with their out-group in that same condition, though the slopes for projection are much flatter. There are no flat or negative slopes for out-group projection in this plot. 

Though not as supportive as I was hoping, I do think it is supportive that - when looking from low to high stereotyping - there is a change in slope and that the slope is flatter in the low stereotyping condition. *This* result indicates that *less projection* is opposite of more stereotyping.

## BFI + ED no stereo

```{r data prep for combined EDBFI models, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
EDBFI_data <- clean_ptcheck %>% 
  select(sub_id, ED_number, BFI_target_group, TargED, selfED, group_cond, 
         opin_pol_combined, BFI_number, selfBFI, TargBFI, 
         stereoBFI, stereoED, identification) %>% 
  na.omit() %>% 
  unique() %>% 
  rename(self_BFI = selfBFI,
         self_ED = selfED,
         Targ_ED = TargED,
         Targ_BFI = TargBFI,
         stereo_BFI = stereoBFI,
         stereo_ED = stereoED) %>% 
  pivot_longer(c(self_BFI, self_ED, Targ_ED, Targ_BFI, stereo_BFI, stereo_ED),
               names_sep = "_",
               names_to = c("EDBFI_groups", "EDBFI_scale")) %>% 
  pivot_wider(names_from = EDBFI_groups, values_from = value) %>% 
  mutate(ED_number = as.numeric(dplyr::recode(ED_number,
                                   `1` = "20",
                                   `2` = "21",
                                   `3` = "22",
                                   `4` = "23",
                                   `5` = "24")),
         EDBFI_number = ifelse(EDBFI_scale == "BFI", BFI_number,
                               ifelse(EDBFI_scale == "ED", ED_number, NA))) %>% 
  select(-c(ED_number, BFI_number, EDBFI_scale)) %>% 
  unique() %>% 
  mutate(self_c = self - mean(self, na.rm = TRUE),
         stereo_c = stereo - mean(stereo, na.rm = TRUE),
         identification_c = identification - mean(identification, na.rm = TRUE))
```

```{r model 2 EDBFI contrasts}
contrasts(EDBFI_data$group_cond) <- contr.sum(2)
contrasts(EDBFI_data$group_cond)
````

```{r model 2 EDBFI no stereo results}
model2EDBFI_nostereo <- lmer(Targ ~ self_c*group_cond + (self_c|sub_id),
               data = EDBFI_data)
summary(model2EDBFI_nostereo)
```

### Plot: ME target group

```{r model 2 EDBFI no stereo prep main effect group}
mod2EDBFI_proj_group_nostereo <- effect(term = "self_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model2EDBFI_nostereo)

mod2EDBFI_proj_group_nostereo <- as.data.frame(mod2EDBFI_proj_group_nostereo)
```

```{r Model 2 EDBFI no stereo main effect group plot}
ggplot(mod2EDBFI_proj_group_nostereo, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using 'Everyday Likes' + BFI items",
         x = "ED + BFI items for self",
         y = "ED + BFI items for target")
```

# Pre-reg Model 2: ED + BFI w/ stereotyping

**Added stereotyping and everyday likes to Model 1 to see if it adding it changed counter projection.**

```{r model 2 EDBFI stereo results}
model2EDBFI_stereo <- lmer(Targ ~ stereo_c*group_cond*self_c + (self_c|sub_id),
               data = EDBFI_data)

summary(model2EDBFI_stereo)
```

When ED and BFI are combined, there is no significant three-way interaction. With stereotyping included as a moderator, the effect of target group on projection is still significant. There is also a significant effect of group on stereotyping that did not exist with just the BFI and stereotyping. Both are plotted below.

### Plot: ME target group on stereo

```{r model 2 EDBFI stereo plot prep}
mod2EDBFI_targ_stereo_effects <- effect(term = "stereo_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"),
                                          stereo_c = c(-1.18, 0, 1.18)), 
                           mod = model2EDBFI_stereo)

mod2EDBFI_targ_stereo_effects <- as.data.frame(mod2EDBFI_targ_stereo_effects)
```

```{r model 2 plot stereo EDBFI}
ggplot(mod2EDBFI_targ_stereo_effects, aes(stereo_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal() +
  labs(title = "Pre-reg Model 2: Effect of target group on stereotyping",
       subtitle = "Higher correspondence between BFI + ED ratings indicates more stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member") +
   theme(legend.title = element_blank())

```

People stereotype their in-group more than their out-group, but this effect was not significant in the model. This does not support our Confirmatory Prediction #2: "People will stereotype the out-group target more than the in-group target due to out-group homogeneity."  

### Plot: ME target group on projection

```{r model 2 EDBFI projection plot prep}
describe(EDBFI_data$self_c)

mod2EDBFI_proj_group_stereo <- effect(term = "group_cond:self_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group")), 
                           mod = model2EDBFI_stereo)

mod2EDBFI_proj_group_stereo <- as.data.frame(mod2EDBFI_proj_group_stereo)
```

```{r model 2 plot projection EDBFI}
ggplot(mod2EDBFI_proj_group_stereo, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7,
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal() +
  labs(title = "Pre-reg Model 2: Effect of target group on projection",
       subtitle = "Controlled for stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member") +
   theme(legend.title = element_blank())
```

When everyday likes items are added to the BFI, even with stereotyping controlled for in the model, we see slight counter projection with the out-group target. This corresponds with Confirmatory Prediction #3: "even with stereotyping as a predictor, projection will still explain variance in ratings of the target, producing the significant main effect predicted above and no model singularities (in other words, how the participant rates the Self and the Stereotypical target will each predict unique variance in ratings of the target;  moreover, the model with both of predictors included will not be singular). Although stereotyping may interact with projection as well (we found this in an earlier study), we do not expect the projection-only effects to go away."

Interestingly, we did not find an interaction of stereotyping with projection in our confirmatory results.


# Pre-reg Mod 3: Identification as moderator

## Confirmatory: W/o stereo for power

**We will use the combined ED + BFI dataset as pre-registered because the results from the original BFI do not appear that different.**

```{r model 3 EDBFI no stereo results}
model3EDBFI_nostereo <- lmer(Targ ~ group_cond*self_c*identification_c + (self_c|sub_id),
               data = EDBFI_data)

summary(model3EDBFI_nostereo)
```

### Plot: Int target group & identification on projection

```{r model 3 no stereo group by ident plot prep}
describe(EDBFI_data$identification_c)

mod3nostereo_proj_ident_effects <- effect(term = "group_cond:self_c:identification_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"), 
                                         identification_c = c(-1.27, 0, 1.27)), 
                           mod = model3EDBFI_nostereo)

mod3nostereo_proj_ident_effects <- as.data.frame(mod3nostereo_proj_ident_effects)

mod3nostereo_proj_ident_effects %<>% 
  mutate(Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low Identification",
                                         `0` = "Average Identification",
                                         `1.27` = "High Identificaiton"))
```

```{r model 3 no stereo group by ident plot}
ggplot(mod3nostereo_proj_ident_effects, aes(self_c, 
                                     fit, 
                                     group = group_cond,
                                     colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_grid(cols = vars(Identification)) +
  theme_minimal() +
  theme(legend.title = element_blank()) +
  labs(title = "Pre-reg Model 3: Projection by identification and group membership",
       subtitle = "Stereotyping removed for power",
       x = "ED + BFI for self",
       y = "ED + BFI for target")
```

As identification increases, out-group counter projection increases as well as in-group projection.

### Plot: ME target group

```{r model 3 no stereo EDBFI prep main effect group}
mod3EDBFI_nostereo_proj_group <- effect(term = "group_cond:self_c", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model3EDBFI_nostereo)

mod3EDBFI_nostereo_proj_group <- as.data.frame(mod3EDBFI_nostereo_proj_group)
```

```{r Model 3 no stereo EDBFI main effect group plot}
ggplot(mod3EDBFI_nostereo_proj_group, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 3: Main effect of target group on projection",
       subtitle = "Using 'Everyday Likes' + BFI items when stereotyping removed",
         x = "ED + BFI items for self",
         y = "ED + BFI items for target")
```

Without stereotyping but including everyday likes and BFI, we see counter projection for out-group targets and regular projection for in-group targets.

## Exploratory: W/ stereotyping

```{r model 3 EDBFI results}
model3EDBFI_stereo <- lmer(Targ ~ stereo_c*group_cond*self_c*identification_c + (self_c|sub_id), data = EDBFI_data)

summary(model3EDBFI_stereo)
```

When BFI and ED combined, significant higher order interactions disappear. 

#### Plot: Projection by stereo, group, & identification

```{r model 3 ED stereo * ident *proj int prep}
describe(EDBFI_data$identification_c)
describe(EDBFI_data$stereo_c)

mod3stereo_4way_effects <- effect(term = "stereo_c:group_cond:self_c:identification_c", 
                           xlevels = list(identification_c = c(-1.27, 0, 1.27),
                                          stereo_c = c(-1.18, 0, 1.18)), 
                           mod = model3EDBFI_stereo)

mod3stereo_4way_effects <- as.data.frame(mod3stereo_4way_effects)

mod3stereo_4way_effects %<>% 
  mutate(Identification = as.factor(identification_c),
         Stereotyping = as.factor(stereo_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low Identification",
                                         `0` = "Ave Identification",
                                         `1.27` = "High Identification"),
         Stereotyping = dplyr::recode(Stereotyping,
                                      `-1.18` = "Low stereotyping",
                                      `0` = "Ave stereotyping",
                                      `1.18` = "High stereotyping")) 
```

```{r model 3 ED stereo x ident x proj int plot}
ggplot(mod3stereo_4way_effects, aes(self_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(Identification, Stereotyping)) +
  theme_sjplot() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Projection by stereotyping, identification, and group",
       subtitle = "Projection using ED + BFI items",
       x = "ED + BFI items for self",
       y = "ED + BFI items for target")
```

Counter projection can be found in the high identification group when they apply an average or high amount of stereotypical BFI traits to their out-group target. This interaction is particularly in contrast to the low identifiers who are also high identifiers, who exhibit no neglible out-group projection but at a high intercept. As this plot demonstrates, high stereotypers are more likely to rate the target on extreme responses than those who are low on stereotypers.

### Plot: ME target group on stereo

```{r model 3 EDBFI stereo plot prep}
mod3EDBFI_plotdata <- effect(term = "stereo_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"),
                                          stereo_c = c(-1.18, 0, 1.18)), 
                           mod = model3EDBFI_stereo)

mod3EDBFI_plotdata <- as.data.frame(mod3EDBFI_plotdata)
```

```{r model 3 plot stereo EDBFI}
ggplot(mod3EDBFI_plotdata, aes(stereo_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal() +
  labs(title = "Plot from Model 3: Effect of target group on stereotyping",
       subtitle = "Higher correspondence between BFI + ED ratings indicates more stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member") +
   theme(legend.title = element_blank())

```

Not significant in model and nothing has changed from earlier models to support Prediction 2.

### Plot: ME target group on projection

```{r model 3 EDBFI projection plot prep}
describe(EDBFI_data$self_c)

mod3EDBFI_proj_group_stereo <- effect(term = "group_cond:self_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group")), 
                           mod = model3EDBFI_stereo)

mod3EDBFI_proj_group_stereo <- as.data.frame(mod3EDBFI_proj_group_stereo)
```

```{r model 3 plot projection EDBFI}
ggplot(mod3EDBFI_proj_group_stereo, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7,
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal() +
  labs(title = "Plot from Model 3: Effect of target group on projection",
       subtitle = "Controlled for stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member") +
   theme(legend.title = element_blank())
```

Both projection and stereotyping plots are the same as the results from Model 3 using ED and BFI, indicating that adding identification into the model with the combined scales did not affect the main effects of projection and stereotyping by group.

In comparison to the Pre-reg Model 3 without stereotyping, adding stereotyping does lessen counter projection with out-groups to a flatter line.

# Exp Model 4 from Pre-reg
