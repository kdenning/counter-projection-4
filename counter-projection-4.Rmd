---
title: "Counter Projection 4 Analyses"
author: "Kathryn Denning"
date: "1/20/2021"
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
editor_options: 
  chunk_output_type: console
---

```{r data prep, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Code to install packages if needed

#install.packages("car")
#install.packages("psych")
#install.packages("lmerTest")
#install.packages("data.table")
#install.packages("sjPlot")
#install.packages("effects")
#install.packages("Cairo")
#install.packages("tinytex")
#install.packages("magrittr")
#install.packages("parameters")
#install.packages("tidyverse")

# Loading packages
library(car)
library(psych)
library(lmerTest)
library(data.table)
library(sjPlot)
library(effects)
library(Cairo)
library(tinytex)
library(magrittr)
library(parameters)
library(tidyverse)

# Improves plots in Windows; This as well as the tinytex packages are not necessary for the rest of the code if run on Mac
knitr::opts_knit$set(dev.args = list(type = "cairo"))

# Setting global chunk options
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)


# Importing data cleaned & saved in the "Data cleaning & exporting.R" doc
clean_ptcheck <- Import("long_format.csv") 
```

```{r cleaning var types, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Cleaning variable types - this cleaning is not sustained when converted to a .csv and read back in
clean_ptcheck %<>% 
  mutate(ED_number = as.numeric(ED_number),
         BFI_number = as.numeric(BFI_number),
         ED_targ_group = as.factor(ED_targ_group),
         BFI_target_group = as.factor(BFI_target_group),
         opin_pol_combined = as.factor(opin_pol_combined),
         race = as.factor(race),
         gender = as.factor(gender),
         education = as.factor(education),
         parent_education = as.factor(parent_education),
         country_birth = as.factor(country_birth),
         native_language = as.factor(native_language),
         citizen = as.factor(citizen),
         us_location = as.factor(us_location),
         group_cond = as.factor(group_cond),
         opin_pol_combined = dplyr::recode(opin_pol_combined,
                                    `1` = "Trump supporter",
                                    `2` = "Anti Trump")) %>% 
  mutate_if(is.integer,funs(as.numeric))
```

# Demographics

## Sample Size

```{r n}
clean_ptcheck %>% 
  select(sub_id) %>% 
  unique() %>% 
  nrow()
```

## N per conditions

### In/out-group

```{r n by group cond}
clean_ptcheck %>% 
  select(sub_id, group_cond) %>% 
  unique() %>% 
  group_by(group_cond) %>% 
  count()

```

### Group & voting opinion

```{r n by group and voting opin}
clean_ptcheck %>% 
  select(sub_id, group_cond, opin_pol_combined) %>% 
  unique() %>% 
  group_by(group_cond, opin_pol_combined) %>% 
  count()
```

## Gender

```{r gender}
clean_ptcheck %>% 
  na.omit() %>% 
  select(sub_id, gender) %>% 
  mutate(gender = dplyr::recode(gender, 
                         `1` = "Male",
                         `2` = "Female",
                         `3` = "Other")) %>% 
  unique() %>% 
  group_by(gender) %>% 
  count()
```

## Race

```{r race}
race_counts <- clean_ptcheck %>% 
  select(sub_id, race) %>% 
  na.omit() %>% 
  mutate(race = dplyr::recode(race, 
                       `1` = "American Indian/Alaska Native",
                       `2` = "Asian",
                       `3` = "Black",
                       `4` = "Latinx",
                       `5` = "Middle Eastern/North African",
                       `6` = "Caucasian",
                       `7` = "Multiracial",
                       `8` = "Other")) %>% 
  unique() %>% 
  group_by(race) %>% 
  count()

race_counts %>% 
  mutate(n_total = sum(race_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Age

```{r age}
clean_ptcheck %>% 
  select(sub_id, age) %>% 
  na.omit() %>% 
  summarize(mean = mean(age),
            sd = sd(age))
```

## Education

```{r participant education}
edu_counts <- clean_ptcheck %>% 
  select(sub_id, education) %>% 
  na.omit() %>% 
  mutate(education = dplyr::recode(education,
                                     `1` = "Less than high school",
                                     `2` = "High school graduate",
                                     `3` = "Some college",
                                     `4` = "Associate's degree",
                                     `5` = "Bachelor's degree",
                                     `6` = "Some graduate school",
                                     `7` = "Master's degree",
                                     `8` = "Doctorate or Professional Degree")) %>% 
  unique() %>% 
  group_by(education) %>% 
  count()

edu_counts %>% 
  mutate(n_total = sum(edu_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Birth country

*All participants are US citizens.*

```{r birth country}
clean_ptcheck %>% 
  select(sub_id, country_birth) %>% 
  na.omit() %>% 
  mutate(country_birth = dplyr::recode(country_birth,
                                      `1` = "US born",
                                      `2` = "Foreign born")) %>% 
  unique() %>% 
  group_by(country_birth) %>% 
  count()
```

## Country raised

```{r country raised}
clean_ptcheck %>% 
  select(sub_id, country_raised) %>% 
  na.omit() %>% 
  mutate(country_raised = dplyr::recode(country_raised,
                                      `1` = "US raised",
                                      `2` = "Foreign raised")) %>% 
  unique() %>% 
  group_by(country_raised) %>% 
  count()
```

## Native lang

```{r native language}
clean_ptcheck %>% 
  select(sub_id, native_language) %>% 
  na.omit() %>% 
  mutate(native_language = dplyr::recode(native_language,
                                      `1` = "English",
                                      `2` = "Foreign language")) %>% 
  unique() %>% 
  group_by(native_language) %>% 
  count()
```

## Overall political beliefs

Question: *Overall, where would you place yourself, on the following scale of liberalism to conservatism? 1 indicates "Very liberal" and 5 indicates "Very conservative"*

### Across group:

```{r histo of overall political leanings}
hist_pol_overall <- clean_ptcheck %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall$poli_orient_1)
```

### In-group:

```{r histo of overall political leanings in-group}
hist_pol_overall_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_in$poli_orient_1)
```

### Out-group:

```{r histo of overall political leanings out-group}
hist_pol_overall_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_out$poli_orient_1)
```

### Trump supporters: 

```{r histo of overall political leanings Trump}
hist_pol_overall_trump <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Trump supporter") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_trump$poli_orient_1)
```

### Anti Trump supporters: 

```{r histo of overall political leanings Trump}
hist_pol_overall_anti <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Anti Trump") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_anti$poli_orient_1)
```

## Social political beliefs

Question: *In terms of social and cultural issues (e.g., abortion, separation of church and state, affirmative action), where would you place yourself on the following scale? 1 indicates "Very liberal" and 5 indicates "Very conservative"*

### Across group:

```{r histo of social political leanings}
hist_pol_social <- clean_ptcheck %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social$poli_orient_2)
```

### In-group:

```{r histo of social political leanings in-group}
hist_pol_social_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_in$poli_orient_2)
```

### Out-group:

```{r histo of social political leanings out-group}
hist_pol_social_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_out$poli_orient_2)
```

### Trump supporters: 

```{r histo of social political leanings Trump}
hist_pol_social_trump <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Trump supporter") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_trump$poli_orient_2)
```

### Anti Trump supporters: 

```{r histo of social political leanings Trump}
hist_pol_social_anti <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Anti Trump") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_anti$poli_orient_2)
```

## Economic political beliefs

Question: *In terms of economic issues (e.g., taxation, welfare, privatization of social security), where would you place yourself on the following scale? 1 indicates "Very liberal" and 5 indicates "Very conservative"*

### Across group:

```{r histo of econ political leanings}
hist_pol_econ <- clean_ptcheck %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ$poli_orient_3)
```

### In-group:

```{r histo of econ political leanings in-group}
hist_pol_econ_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_in$poli_orient_3)
```

### Out-group:

```{r histo of econ political leanings out-group}
hist_pol_econ_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_out$poli_orient_3)
```

### Trump supporters: 

```{r histo of econ political leanings Trump}
hist_pol_econ_trump <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Trump supporter") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_trump$poli_orient_3)
```

### Anti Trump supporters: 

```{r histo of econ political leanings Trump}
hist_pol_econ_anti <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Anti Trump") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_anti$poli_orient_3)
```

## Political knowledge

Question: *Which party has the most members in the U.S. House of Representatives in Washington, D.C.?*

**This data was collected in October 2020, when the House was Democratic**

```{r house correct}
clean_ptcheck %>% 
  select(sub_id, house_most_members) %>% 
  na.omit() %>% 
  unique() %>% 
  mutate(house_most_members = dplyr::recode(house_most_members,
                                            `2` = "Democrat control",
                                            `6` = "Republican control",
                                            `3` = "Do not know")) %>% 
  group_by(house_most_members) %>% 
  count()
```

This question shows that 114 people answered incorrectly and 104 did not know. Political knowledge and extreme political beliefs (how liberal or conservative someone is) could impact results and could be used as an exploratory moderator.

```{r impact of NA removal on overall data}
clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined)  %>% 
  unique() %>% 
  count()

# how unique numbers of datapoints change when we remove na's in long-format
clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined)  %>% 
  na.omit() %>% 
  unique() %>% 
  count()

# We will remove per analysis in the overall data-set to avoid data removal of participants due to irrelevant variables having NAs that cause the removal
```

# Pre-reg Mod 1: Projection by group w/ BFI

```{r model 1 data}
# removing na's and repeat data due to long-format variables no longer included in this analysis
model1_data <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined) %>% 
  na.omit() %>% 
  unique()
```

**Getting effects coding for target group:**

```{r}
contrasts(model1_data$group_cond) <- contr.sum(2)
contrasts(model1_data$group_cond)
````

```{r model 1 results}
model1 <- lmer(TargBFI ~ selfBFI_c*group_cond + (selfBFI_c|sub_id),
               data = model1_data)
summary(model1)
```

### Plot: ME target group

```{r model 1 prep main effect group}
mod1_proj_group <- effect(term = "selfBFI_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model1)

mod1_proj_group <- as.data.frame(mod1_proj_group)
```

```{r Model 1 main effect group plot}
ggplot(mod1_proj_group, aes(selfBFI_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Plot from Model 1: Main effect of target group on projection",
       subtitle = "Projection using BFI",
         x = "Personality responses for self",
         y = "Personality responses for target")
```

We replicate our prior finding that people counter project with their political out-group, but project positively with their political in-group target.

This supports Confirmatory Prediction #1: *"People will counter-project to a target person from their political out-group and project to a target person from their in-group."*

# Hierachial build-up to Pre-reg Mod 2

## Adding Everyday Likes (ED)

```{r model 2 ED data}
model2ED_data <- clean_ptcheck %>% 
  select(sub_id, ED_number, TargED, selfED_c, group_cond, 
         opin_pol_combined, stereoED_c) %>% 
  na.omit() %>% 
  unique()
```

**Getting effects coding for target group:**

```{r}
contrasts(model2ED_data$group_cond) <- contr.sum(2)
contrasts(model2ED_data$group_cond)
````

### ED without stereotyping in model

```{r model 2 ED results not pre-reg}
model2ED_notpr <- lmer(TargED ~ selfED_c*group_cond + (selfED_c|sub_id),
               data = model2ED_data)
summary(model2ED_notpr)
```

#### Plot: ME target group

```{r model 2 ED prep main effect group}
mod2ED_proj_group <- effect(term = "selfED_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model2ED_notpr)

mod2ED_proj_group <- as.data.frame(mod2ED_proj_group)
```

```{r Model 2 ED main effect group plot}
ggplot(mod2ED_proj_group, aes(selfED_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using 'Everyday Likes' (ED) items before stereotyping added",
         x = "ED items for self",
         y = "ED items for target")
```

Without stereotyping, we see even more extreme counter projection.

### ED w/ stereotyping in model

```{r model 2 ED results}
model2EDwstereo <- lmer(TargED ~ selfED_c*group_cond*stereoED_c + (1|sub_id),
               data = model2ED_data)
summary(model2EDwstereo)
```

Running it on its own with stereotyping (which Model 2 includes adding both ED and stereotyping at once) does not converge. Most likely due to too few items nested within the higher level for so many variables and not enough variance between the two.

We removed random slopes for the selfED_c predictor and then the model converged. We looked at the impact of removing this random slope in models for the everyday likes without stereotyping and BFI with stereotyping and found it did not have an impact on results, making us trust the patterns shown in this model.

#### Plot: ME target group

```{r model 2 ED prep main effect group with stereo}
mod2ED_proj_group_wstereo <- effect(term = "selfED_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model2EDwstereo)

mod2ED_proj_group_wstereo <- as.data.frame(mod2ED_proj_group_wstereo)
```

```{r Model 2 ED main effect group plot with stereo}
ggplot(mod2ED_proj_group_wstereo, aes(selfED_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using ED likes items controlling for stereotyping",
         x = "ED items for self",
         y = "ED items for target")
```

We still see counter projection, even when controlling for stereotyping.

## BFI only with stereo

```{r model 2 bfi stereo data}
model2_bfistereo <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined, stereoBFI_c) %>% 
  na.omit() %>% 
  unique()
```

**Getting effects coding for target group:**

```{r contrast codes model 2 bfi stereo}
contrasts(model2_bfistereo$group_cond) <- contr.sum(2)
contrasts(model2_bfistereo$group_cond)
```

```{r model 2 bfi stereo results}
model2_bfistereo_resuts <- lmer(TargBFI ~ selfBFI_c*group_cond*stereoBFI_c + (selfBFI_c |sub_id), data = model2_bfistereo)

summary(model2_bfistereo_resuts)
```

Model failed to converge when allowing stereotyping to have random slopes as well, so only included self as random slopes.

The main effect of selfBFI_c:group_condOut-group did not disappear when including stereotyping as a moderator, replicating the exploratory results from Study 1 (my FYP), and there was no interaction of stereotyping*target group on projection. However, there is a three-way interaction that we need to consider, and we need to consider how the plots look.

### Plot: ME target group

```{r model 2 prep main effect group}
model2_bfistereo_group_effects <- effect(term = "selfBFI_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model2_bfistereo_resuts)

model2_bfistereo_group_effects <- as.data.frame(model2_bfistereo_group_effects)
```

```{r Model 3 main effect group plot}
ggplot(model2_bfistereo_group_effects, aes(selfBFI_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 2: Main effect of target group on projection using BFI",
       subtitle = "Controlling for stereotyping",
         x = "Personality responses for self",
         y = "Personality responses for target")
```

When controlling for stereotyping, the counter projection found earlier does disappear.

### Plot: stereo x group int

```{r model 2 interaction with stereo prep}
describe(model2_bfistereo$stereoBFI_c)

model2_bfistereo_int_effects <- effect(term = "selfBFI_c:group_cond:stereoBFI_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"), 
                                         stereoBFI_c = c(-1.22, 0, 1.22)), 
                           mod = model2_bfistereo_resuts)

model2_bfistereo_int_effects <- as.data.frame(model2_bfistereo_int_effects)

model2_bfistereo_int_effects %<>% 
  mutate(Stereotyping = as.factor(stereoBFI_c),
         Stereotyping = dplyr::recode(Stereotyping,
                                      `-1.22` = 
                                        "Low stereotyping \n (1 SD below)",
                                      `0` = 
                                        "Average stereotyping",
                                      `1.22` = 
                                        "High stereotyping  \n(1 SD above)"))
```

```{r model 2 interaction plot with stereo}
ggplot(model2_bfistereo_int_effects, aes(selfBFI_c, 
                                     fit, 
                                     group = group_cond,
                                     colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_grid(cols = vars(Stereotyping)) +
  theme_minimal() +
  labs(title = "Model 2: Projection by stereotype use and group membership",
       subtitle = "Using BFI only - not explicitly pre-registered",
       x = "Personality traits for self",
       y = "Personality traits for target",
       linetype = "Group")
```

It appears that as stereotype use increases, the intercept for projection for both in-group and out-group increases and the difference between groups increases as well. People are projecting more for their in-group when they stereotype the least, but also appear to be projecting less with their out-group in that same condition, though the slopes for projection are much flatter. There are no flat or negative slopes for out-group projection in this plot. 

## BFI + ED no stereo

```{r EDBFI data cleaning}
EDBFI_overall <- clean_ptcheck %>% 
  # only keeping variables relevant to analyses that will follow in this doc
  select(sub_id, ED_number, BFI_target_group, TargED, selfED, group_cond, 
         opin_pol_combined, BFI_number, selfBFI, TargBFI, 
         stereoBFI, stereoED, identification, contentiousness, fundaMoral, 
         threat, lib, cons, house_most_members) %>% 
  # after getting rid of other variables, getting unique lines of code to get rid of repeat lines of code that came from long-format of other variables
  unique() %>%
  # renaming variables so that I can separate them in a useful way when using pivot
  rename(self_BFI = selfBFI,
         self_ED = selfED,
         Targ_ED = TargED,
         Targ_BFI = TargBFI,
         stereo_BFI = stereoBFI,
         stereo_ED = stereoED) %>% 
  # using pivot to combine BFI and ED into one column
  pivot_longer(c(self_BFI, self_ED, Targ_ED, Targ_BFI, stereo_BFI, stereo_ED),
               names_sep = "_",
               names_to = c("EDBFI_groups", "EDBFI_scale")) %>% 
  pivot_wider(names_from = EDBFI_groups, values_from = value) %>% 
  # changing the ED numbers to continue at the end of the BFI numbers so there is one column as a unique identifier for the order of items in the EDBFI variable
  mutate(ED_number = as.numeric(dplyr::recode(ED_number,
                                              `1` = "20",
                                              `2` = "21",
                                              `3` = "22",
                                              `4` = "23",
                                              `5` = "24")),
         # combining the number scales for BFI and ED into one
         EDBFI_number = ifelse(EDBFI_scale == "BFI", BFI_number,
                               ifelse(EDBFI_scale == "ED", ED_number, NA))) %>% 
  # dropping variables no longer needed after cleaning
  select(-c(ED_number, BFI_number, EDBFI_scale)) %>% 
  # getting rid of rows that became repeats through the wrangling
  unique() %>% 
  # mean centering continuous predictors for confirmatory analyses
  mutate(self_c = self - mean(self, na.rm = TRUE),
         stereo_c = stereo - mean(stereo, na.rm = TRUE),
         identification_c = identification - mean(identification, na.rm = TRUE))

# Making a data-set that doesn't have exploratory variables for confirmatory analyses to only remove NA's in confirmatory variables for these models to retain as much data as possible
EDBFI_mod2 <- EDBFI_overall %>% 
  select(-c(contentiousness, fundaMoral, 
            threat, lib, cons, house_most_members, 
            identification, identification_c)) %>% 
  na.omit()
```

```{r n EDBFI data}
# no participants dropped from model 1 to model 2 for EDBFI
EDBFI_mod2 %>% 
  select(sub_id) %>% 
  unique() %>% 
  nrow()
```

```{r model 2 EDBFI contrasts}
contrasts(EDBFI_mod2$group_cond) <- contr.sum(2)
contrasts(EDBFI_mod2$group_cond)
````

```{r model 2 EDBFI no stereo results}
model2EDBFI_nostereo <- lmer(Targ ~ self_c*group_cond + (self_c|sub_id),
               data = EDBFI_mod2)
summary(model2EDBFI_nostereo)
```

### Plot: ME target group

```{r model 2 EDBFI no stereo prep main effect group}
mod2EDBFI_proj_group_nostereo <- effect(term = "self_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model2EDBFI_nostereo)

mod2EDBFI_proj_group_nostereo <- as.data.frame(mod2EDBFI_proj_group_nostereo)
```

```{r Model 2 EDBFI no stereo main effect group plot}
ggplot(mod2EDBFI_proj_group_nostereo, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using 'Everyday Likes' + BFI items",
         x = "ED + BFI items for self",
         y = "ED + BFI items for target",
       linetype = "Group")
```

With everyday likes added to the BFI, the main effect of target group on projection does not change.

# Pre-reg Model 2: ED + BFI w/ stereotyping

**Added stereotyping and everyday likes to Model 1 to see if it adding it changed counter projection.**

```{r model 2 EDBFI stereo results}
model2EDBFI_stereo <- lmer(Targ ~ stereo_c*group_cond*self_c + (self_c|sub_id),
               data = EDBFI_mod2)

summary(model2EDBFI_stereo)
```

When stereotyping is added as a random slope, the model does not converge. Thus, we chose to only include self as a random slope.

When ED and BFI are combined, there is no significant three-way interaction with stereotyping, self, and group. With stereotyping included as a moderator, the effect of target group on projection is still significant. The effect of group on stereotyping is not significant, which relates to our Prediction #2, discussed with the plot.

### Plot: ME target group on stereo

```{r model 2 EDBFI stereo plot prep}
mod2EDBFI_targ_stereo_effects <- effect(term = "stereo_c:group_cond", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group")), 
                           mod = model2EDBFI_stereo)

mod2EDBFI_targ_stereo_effects <- as.data.frame(mod2EDBFI_targ_stereo_effects)
```

```{r model 2 plot stereo EDBFI}
ggplot(mod2EDBFI_targ_stereo_effects, aes(stereo_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal() +
  labs(title = "Pre-reg Model 2: NS Effect of target group on stereotyping",
       subtitle = "Higher correspondence between BFI + ED ratings indicates more stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member",
       linetype = "Group")
```

People stereotype their in-group and out-group to a similar extent, but the intercept differs. This does not support our Confirmatory Prediction #2: "People will stereotype the out-group target more than the in-group target due to out-group homogeneity."  

### Plot: ME target group on projection

```{r model 2 EDBFI projection plot prep}
mod2EDBFI_proj_group_stereo <- effect(term = "group_cond:self_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group")), 
                           mod = model2EDBFI_stereo)

mod2EDBFI_proj_group_stereo <- as.data.frame(mod2EDBFI_proj_group_stereo)
```

```{r model 2 plot projection EDBFI}
ggplot(mod2EDBFI_proj_group_stereo, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7,
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal() +
  labs(title = "Pre-reg Model 2: Effect of target group on projection",
       subtitle = "Controlled for stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for self",
       linetype = "Group") 
   theme(legend.title = element_blank())
```

When everyday likes items are added to the BFI, even with stereotyping controlled for in the model, we see slight counter projection with the out-group target. This corresponds with Confirmatory Prediction #3: "even with stereotyping as a predictor, projection will still explain variance in ratings of the target, producing the significant main effect predicted above and no model singularities (in other words, how the participant rates the Self and the Stereotypical target will each predict unique variance in ratings of the target;  moreover, the model with both of predictors included will not be singular). Although stereotyping may interact with projection as well (we found this in an earlier study), we do not expect the projection-only effects to go away."

Interestingly, we did not find an interaction of stereotyping with projection in our confirmatory results.

# Pre-reg Mod 3: Identification as moderator

## Confirmatory: W/o stereo for power

**We will use the combined ED + BFI data-set as pre-registered because the results from the original BFI do not appear that different.**

```{r mod 3 data}
EDBFI_mod3 <- EDBFI_overall %>% 
  select(-c(contentiousness, fundaMoral, 
            threat, lib, cons, house_most_members)) %>% 
  na.omit()

EDBFI_mod3 %>% 
  select(sub_id) %>% 
  unique() %>% 
  nrow()

# 2 participants dropped due to missing data in identification
```

```{r model 3 EDBFI no stereo results}
model3EDBFI_nostereo <- lmer(Targ ~ group_cond*self_c*identification_c + (self_c|sub_id),
               data = EDBFI_mod3)

summary(model3EDBFI_nostereo)
```

The interaction of target group and identification on projection is significant. The main effect of target group is still significant. There is a marginal effect of identification on projection.

### Plot: Int target group & identification on projection

```{r model 3 no stereo group by ident plot prep}
describe(EDBFI_data$identification_c)

mod3nostereo_proj_ident_effects <- effect(term = "group_cond:self_c:identification_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"), 
                                         identification_c = c(-1.27, 0, 1.27)), 
                           mod = model3EDBFI_nostereo)

mod3nostereo_proj_ident_effects <- as.data.frame(mod3nostereo_proj_ident_effects)

mod3nostereo_proj_ident_effects %<>% 
  mutate(Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low identification \n (1 SD below)",
                                         `0` = "Average identification",
                                         `1.27` = "High identificaiton \n (1 SD above)"))
```

```{r model 3 no stereo group by ident plot}
ggplot(mod3nostereo_proj_ident_effects, aes(self_c, 
                                     fit, 
                                     group = group_cond,
                                     colour = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black",
              aes(linetype = group_cond)) +
  facet_grid(cols = vars(Identification)) +
  theme_minimal() +
  labs(title = "Pre-reg Model 3: Projection by identification and group membership",
       subtitle = "Stereotyping removed for power",
       x = "ED + BFI for self",
       y = "ED + BFI for target",
       linetype = "Group")
```

As identification increases, out-group counter projection increases as well as in-group projection.

### Plot: ME Target group

```{r model 3 no stereo EDBFI prep main effect group prep}
mod3EDBFI_nostereo_proj_group <- effect(term = "group_cond:self_c", 
                           xlevels = list(group_cond = c("In-group", "Out-group")), 
                           mod = model3EDBFI_nostereo)

mod3EDBFI_nostereo_proj_group <- as.data.frame(mod3EDBFI_nostereo_proj_group)
```

```{r Model 3 no stereo EDBFI main effect group plot}
ggplot(mod3EDBFI_nostereo_proj_group, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  labs(title = "Model 3: Main effect of target group on projection",
       subtitle = "Using 'Everyday Likes' + BFI items when stereotyping removed",
         x = "ED + BFI items for self",
         y = "ED + BFI items for target",
         linetype = "Group")
```

Without stereotyping but including everyday likes and BFI, we see counter projection for out-group targets and regular projection for in-group targets.

### Plot: Marginal ME Identification

```{r model 3 no stereo EDBFI prep main effect ident}
mod3EDBFI_nostereo_proj_ident <- effect(term = "self_c:identification_c",
                           xlevels = list(identification_c = c(-1.27, 0, 1.27)), 
                           mod = model3EDBFI_nostereo)

mod3EDBFI_nostereo_proj_ident <- as.data.frame(mod3EDBFI_nostereo_proj_ident)

mod3EDBFI_nostereo_proj_ident %<>% 
  mutate(Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low identification \n (1 SD below)",
                                         `0` = "Average identification",
                                         `1.27` = "High identificaiton \n (1 SD above)"))
```

```{r Model 3 no stereo EDBFI main effect ident plot}
ggplot(mod3EDBFI_nostereo_proj_ident, aes(self_c, fit, group = Identification)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = Identification)) +
  theme_minimal(base_size = 13) +
  labs(title = "Model 3: Main effect of identification on projection",
       subtitle = "Using 'Everyday Likes' + BFI items when stereotyping removed",
         x = "ED + BFI items for self",
         y = "ED + BFI items for target",
         linetype = "Group")
```

On lower scores for ED + BFI, there is less difference in projection between identification groups. As identification increases, you see more projection in high identifiers compared to average and then low identifiers.

## Exploratory: W/ stereotyping

```{r model 3 EDBFI results}
model3EDBFI_stereo <- lmer(Targ ~ stereo_c*group_cond*self_c*identification_c + (self_c|sub_id), data = EDBFI_data)

summary(model3EDBFI_stereo)
```

When BFI and ED are combined and added to a model controlled by stereotyping, the interaction between condition and identification on projection disappears. There is a significant interaction of stereotyping and identification on projection collapsed across group. There is a significant main effect of identification on stereotyping as well as group on projection. There is also a marginal interaction of group and identification on stereotyping. 

### Plot: ME target group on projection

```{r model 3 EDBFI projection plot prep}
mod3EDBFI_proj_group_stereo <- effect(term = "group_cond:self_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group")), 
                           mod = model3EDBFI_stereo)

mod3EDBFI_proj_group_stereo <- as.data.frame(mod3EDBFI_proj_group_stereo)
```

```{r model 3 plot projection EDBFI}
ggplot(mod3EDBFI_proj_group_stereo, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7,
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal() +
  labs(title = "Plot from Model 3: Effect of target group on projection",
       subtitle = "Controlled for stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member") +
   theme(legend.title = element_blank())
```

Both projection and stereotyping plots are the same as the results from Model 3 using ED and BFI, indicating that adding identification into the model with the combined scales did not affect the main effects of projection and stereotyping by group. We still see slight counter projection with the out-group and positive projection with the in-group.

### Plot: Int Stereo & Ident on Projection

```{r model 3 ED stereo x ident x proj int prep}
describe(EDBFI_data$stereo_c)

mod3stereo_3way_effects <- effect(term = "stereo_c:self_c:identification_c", 
                           xlevels = list(identification_c = c(-1.27, 0, 1.27),
                                          stereo_c = c(-1.18, 0, 1.18)), 
                           mod = model3EDBFI_stereo)

mod3stereo_3way_effects <- as.data.frame(mod3stereo_3way_effects)

mod3stereo_3way_effects %<>% 
  mutate(Identification = as.factor(identification_c),
         Stereotyping = as.factor(stereo_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low Identification",
                                         `0` = "Ave Identification",
                                         `1.27` = "High Identification"),
         Stereotyping = dplyr::recode(Stereotyping,
                                      `-1.18` = "Low stereotyping",
                                      `0` = "Ave stereotyping",
                                      `1.18` = "High stereotyping")) 
```

```{r model 3 ED stereo x ident x proj int plot}
ggplot(mod3stereo_3way_effects, aes(self_c, 
                                      fit, 
                                      group = Identification, 
                                      colour = Identification)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Identification)) +
  facet_wrap(vars(Stereotyping)) +
  theme_sjplot() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 3: Projection predicted by stereotyping and identification",
       subtitle = "Projection using ED + BFI items",
       x = "ED + BFI items for self",
       y = "ED + BFI items for target")
```

Collapsed across in and out-group target, people who apply low stereotypes to the target, project more as in-group identification increases. Interestingly, people who demonstrate high use of stereotypes to the target exhibit the opposite pattern: low in-group identifiers project the most and as in-group identification increases, projection decreases. Average stereotype users all project around the same amount.

```{r mod 3 stereo plot prep for stereo by ident}
describe(EDBFI_data$stereo_c)

mod3stereo_ident <- effect(term = "stereo_c:identification_c", 
                           xlevels = list(identification_c = c(-1.27, 0, 1.27)), 
                           mod = model3EDBFI_stereo)

mod3stereo_ident <- as.data.frame(mod3stereo_ident)

mod3stereo_ident %<>% 
  mutate(Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low Identification",
                                         `0` = "Ave Identification",
                                         `1.27` = "High Identification"))
```

```{r mod 3 stereo plot for stereo by ident}
ggplot(mod3stereo_ident, aes(stereo_c, fit, group = Identification, colour = Identification)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Identification)) +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Stereotyping by identification",
       subtitle = "Using ED + BFI items",
       x = "ED + BFI items for stereotypical group",
       y = "ED + BFI items for target") +
  theme_minimal()
```

As identification increases, stereotyping increases.

#### Marginal: Stereo by group & identification

**This was not significant, but plotted to see the relationship of all variables.**

```{r model 3 ED stereo x ident x group int prep}
describe(EDBFI_data$identification_c)

mod3stereobygroupident <- effect(term = "stereo_c:group_cond:identification_c", 
                           xlevels = list(identification_c = c(-1.27, 0, 1.27),
                                          group_cond = c("In-group", "Out-group")), 
                           mod = model3EDBFI_stereo)

mod3stereobygroupident <- as.data.frame(mod3stereobygroupident)

mod3stereobygroupident %<>% 
  mutate(Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low Identification",
                                         `0` = "Ave Identification",
                                         `1.27` = "High Identification")) 
```

```{r model 3 ED stereo x ident x group int plot}
ggplot(mod3stereobygroupident, aes(stereo_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(Identification)) +
  theme_sjplot() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Marginal: Stereotyping by identification and group",
       subtitle = "Using ED + BFI items",
       x = "ED + BFI items for stereotypical group",
       y = "ED + BFI items for target")
```

High identifiers respond more extremely about stereotypical responses than low identifiers, and this difference in intercept between in and out-group targets is more pronounced for high identifiers than low identifiers.

# Exp Model 4 from Pre-reg

## EFA for ED + BFI data

https://cran.r-project.org/web/packages/parameters/vignettes/efa_cfa.html

Missing data per individual difference variable:

```{r getting data for exploratory analsyses}
indivdiff_data <- EDBFI_overall %>% 
  mutate_at(vars(lib), ~replace(., is.na(.), 99)) %>% #to remove NA's using filtering, making them 99's first, since filter wasn't letting me filter "NA"
  filter(lib != "99") %>% 
  mutate(perceive_polar = abs(lib - cons),
         perceive_polar_c = perceive_polar - mean(perceive_polar, na.rm = TRUE),
         content_c = contentiousness - mean(contentiousness, na.rm = TRUE),
         threat_c = threat - mean(threat, na.rm = TRUE),
         fundaMoral_c = fundaMoral - mean(fundaMoral, na.rm = TRUE))#getting variable for perceived polar by subtracting perceived polarization for conservatives from liberals and getting teh absolute value of that diff
  
EFA <- indivdiff_data %>% 
  select(sub_id, identification, threat, perceive_polar, fundaMoral, contentiousness) %>% 
  unique() %>% 
  select(-sub_id)

# Not too much missing data, I think we should be okay on power
sapply(EFA, function(x) sum(is.na(x)))
```

**Should we run an EFA? Is our data applicable?**

```{r EFA check}
# Check factor structure to see if there is enough correlation, etc. for factor analysis
check_factorstructure(EFA)
```

These tests say yes

```{r EFA n factor check}
factors_exp <- n_factors(EFA)
factors_exp

summary(factors_exp)
```

The majority of tests suggest only 1 factor, followed by 2 or 4 latent factors. 2 latent factors may make more theoretical sense for so few variables, but we will look at all three options.

```{r EFAs}
efa_1fac <- psych::fa(EFA, nfactors = 1) %>% 
  model_parameters(sort = TRUE, threshold = "max")
efa_1fac

efa_2fac <- psych::fa(EFA, nfactors = 2) %>% 
  model_parameters(sort = TRUE, threshold = "max")
efa_2fac

efa_4fac <- psych::fa(EFA, nfactors = 4) %>% 
  model_parameters(sort = TRUE, threshold = "max")
efa_4fac
```

The EFA with 2 factors explains more of the total variance of the original data (49%). The 4 factor then explained the next highest amount of total variance (42%). Our singly factor latent variable EFA explained only 33% of the total variance.

It appears that the 2 factor structure is our best structure. This structure combines all factors but contentiousness into one factor, leaving us with factor 1: group beliefs and factor 2: contentiousness. 

If we were to follow the 4 factor structure, only threat and contentiousness are combined into one factor, which I would label "aggression." Fundamental Morals, Identificaiton, and Perceived Polarization all fall into unique factors in this EFA.

### Alpha comparisons

#### 1 factor

For comparison to other alphas:

```{r alpha 1 factor}
psych::alpha(EFA)
```

This alpha is .6. The latent factors for our 2 factor and 4 factor would need to be better.

#### 2 factor combined factor

```{r alpha 2 factor}
group_beliefs <- EFA %>% 
  select(c(identification, perceive_polar, fundaMoral, threat))

psych::alpha(group_beliefs)
```

#### 4 factor combined factor

```{r check reliability before combining factors}
aggression <- EFA %>% 
  select(c(threat, contentiousness))

psych::alpha(aggression)
```

Interestingly, the two-factor structure does not contain the best (or acceptable) reliability. The group beliefs factor only reaches an alpha of .56. The aggression factor in the 4 factor latent structure EFA only reaches an alpha of .54. When all 5 are combined, they have an alpha of .6. The overall alpha showed that if perceived polarization is dropped, the other four variables would achieve an alpha of .69, which is the highest alpha out of all the combinations and the only one bordering on acceptable. Dropping identification - which we have already run in our confirmatory analysis - only gets an alpha of .57. Since we stated we would only combine into factors if over .8, which these are not, we will not be combining into factors based on these criteria. 

We did state that we would combined moderators that were correlated greater than .7 if the EFA and reliability plan failed. We will look into this next.

## Correlation matrix

```{r correlation matrix}
cor(EFA, method = "pearson", use = "complete.obs")
```

None of the variables are correlation over .7 (actually .52 is the highest), so we will use them all individually.

## Exploratory Moderator Results w/o stereo

**We pre-registered that, for power and because this was an exploratory analysis on the effect of individual differences on counter projection, we would not include stereotyping in this part of the analysis.**

```{r indiv data}
indivdiff_data_nostereo <- indivdiff_data %>% 
  select(-stereo, -stereo_c, -perceive_polar, - contentiousness, -stereo, -self,
         -lib, -cons, -fundaMoral, -threat, -identification) %>% 
  na.omit()

contrasts(indivdiff_data_nostereo$group_cond) <- contr.sum(2)
contrasts(indivdiff_data_nostereo$group_cond)
```

### Perceived polar model

```{r}
model4_polar <- lmer(Targ ~ group_cond*self_c*perceive_polar_c  +
                        + (self_c|sub_id),
               data = indivdiff_data_nostereo)

summary(model4_polar)
```

#### Group x Polarization Int Plot

```{r model 4 perceived polarization 3 way prep}
describe(indivdiff_data_nostereo$perceive_polar_c)

mod4_polar_effects <- effect(term = "group_cond:self_c:perceive_polar_c", 
                           xlevels = list(perceive_polar_c = c(-2.42, 0, 2.42),
                                          group_cond = c("In-group", "Out-group")), 
                           mod = model4_polar)

mod4_polar_effects <- as.data.frame(mod4_polar_effects)

mod4_polar_effects %<>% 
  mutate(Polarization = as.factor(perceive_polar_c),
         Polarization = dplyr::recode(Polarization,
                                         `-2.42` = "Low Polarization",
                                         `0` = "Ave Polarization",
                                         `2.42` = "High Polarization")) 
```

```{r model 4 perceived polar 3 way plot}
ggplot(mod4_polar_effects, aes(self_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(Polarization)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by group and perceived polarization",
       subtitle = "Projection using ED + BFI items",
       x = "ED + BFI items for self",
       y = "ED + BFI items for target")
```

This interaction is driven by the fact that, when people perceive low polarization, they project with their out-group. However, as polarization increases, counter projection with the out-group target increases. The intercept of positive projection also increases with the in-group as polarizaiton increases.

### Threat model

```{r}
model4_threat <- lmer(Targ ~ group_cond*self_c*threat_c  +
                        + (self_c|sub_id),
               data = indivdiff_data_nostereo)

summary(model4_threat)

```

#### Group x Threat Int Plot

```{r model 4 threat 3 way prep}
describe(indivdiff_data_nostereo$threat_c)

mod4_threat_effects <- effect(term = "group_cond:self_c:threat_c", 
                           xlevels = list(threat_c = c(-1.39, 0, 1.39),
                                          group_cond = c("In-group", "Out-group")), 
                           mod = model4_threat)

mod4_threat_effects <- as.data.frame(mod4_threat_effects)

mod4_threat_effects %<>% 
  mutate(Threat = as.factor(threat_c),
         Threat = dplyr::recode(Threat,
                                `-1.39` = "Low threat",
                                `0` = "Ave Polarization",
                                `1.39` = "High threat")) 
```

```{r model 4 threat 3 way plot}
ggplot(mod4_threat_effects, aes(self_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(Threat)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by group and threat",
       subtitle = "Projection using ED + BFI items",
       x = "ED + BFI items for self",
       y = "ED + BFI items for target")
```

Same as in polarization, though the slope for those who report low threat is not as steep. Nevertheless, those who do not see those who vote differently as them as threatening project with their out-group. However, as perceived threat increases, counter projection increases. 

### Contentiousness model

```{r}
model4_content <- lmer(Targ ~ group_cond*self_c*content_c  +
                        + (self_c|sub_id),
               data = indivdiff_data_nostereo)

summary(model4_content)
```

```{r model 4 content 3 way prep}
describe(indivdiff_data_nostereo$content_c)

mod4_content_effects <- effect(term = "group_cond:self_c:content_c", 
                           xlevels = list(content_c = c(-1.09, 0, 1.09),
                                          group_cond = c("In-group", "Out-group")), 
                           mod = model4_content)

mod4_content_effects <- as.data.frame(mod4_content_effects)

mod4_content_effects %<>% 
  mutate(Contentiousness = as.factor(content_c),
         Contentiousness = dplyr::recode(Contentiousness,
                                `-1.09` = "Low contentiousness",
                                `0` = "Ave contentiousness",
                                `1.09` = "High contentiousness")) 
```

```{r model 4 content 3 way plot}
ggplot(mod4_content_effects, aes(self_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(Contentiousness)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by group and contentiousness",
       subtitle = "This interaction is not significant",
       x = "ED + BFI items for self",
       y = "ED + BFI items for target")
```

### Fundamental moral model

```{r}
model4_fundmoral <- lmer(Targ ~ group_cond*self_c*fundaMoral_c  +
                        + (self_c|sub_id),
               data = indivdiff_data_nostereo)

summary(model4_fundmoral)
```

```{r model 4 fund moral 3 way prep}
describe(indivdiff_data_nostereo$fundaMoral_c)

mod4_fundmoral_effects <- effect(term = "group_cond:self_c:fundaMoral_c", 
                           xlevels = list(fundaMoral_c = c(-1.17, 0, 1.17),
                                          group_cond = c("In-group", "Out-group")), 
                           mod = model4_fundmoral)

mod4_fundmoral_effects <- as.data.frame(mod4_fundmoral_effects)

mod4_fundmoral_effects %<>% 
  mutate(fundaMoral = as.factor(fundaMoral_c),
         fundaMoral = dplyr::recode(fundaMoral,
                                `-1.17` = "Low importance to /n fundamental beliefs",
                                `0` = "Average",
                                `1.17` = "High importance to /n fundamental beliefs")) 
```

```{r model 4 fund moral 3 way plot}
ggplot(mod4_fundmoral_effects, aes(self_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(fundaMoral)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by fundamental morals and group",
       subtitle = "Projection using ED + BFI items",
       x = "ED + BFI items for self",
       y = "ED + BFI items for target")
```

### Combined model

```{r model 4 without stereo}
model4_nostereo <- lmer(Targ ~ group_cond*self_c*perceive_polar_c +
                          group_cond*self_c*threat_c +
                          group_cond*self_c*content_c +
                          group_cond*self_c*fundaMoral_c +
                        + (self_c|sub_id),
               data = indivdiff_data_nostereo)

summary(model4_nostereo)
```

Even with moderators, we still have a significant main effect of group. The significant interactions of group and perceived polarization and fundamental beliefs remain, but the interaction with threat disappears.

# Other Exploratory Analyses

## Exp results w/ voting opinion

### ED + BFI Results

```{r exp opin EDBFI results}
mod_opin_EDBFI <- lmer(Targ ~ group_cond*self_c*opin_pol_combined +
                        + (self_c|sub_id),
               data = EDBFI_data)

summary(mod_opin_EDBFI)
```

#### Plot ME opinion

```{r exp opin plot EDBFI opin main}
ggplot(EDBFI_data, aes(self_c, 
                       Targ, 
                       group = opin_pol_combined, 
                       colour = opin_pol_combined)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = opin_pol_combined)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by voting opinion",
       subtitle = "Projection using ED + BFI items",
       x = "ED + BFI items for self",
       y = "ED + BFI items for target")
```

### ED Only

```{r exp opin ED results}
#removing na's for particular analysis for ED analysis
mod_opin_ed_data <- clean_ptcheck %>% 
  select(sub_id, TargED, group_cond, selfED_c, opin_pol_combined) %>% 
  na.omit()

mod_opin_ED <- lmer(TargED ~ group_cond*selfED_c*opin_pol_combined +
                        + (selfED_c|sub_id),
               data = mod_opin_ed_data)

summary(mod_opin_ED)
```

#### Plot ME Opinion

```{r exp opin plot ED opin main}
ggplot(mod_opin_ed_data, aes(selfED_c, 
                       TargED, 
                       group = opin_pol_combined, 
                       colour = opin_pol_combined)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = opin_pol_combined)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by voting opinion",
       subtitle = "Projection using ED items",
       x = "ED items for self",
       y = "ED items for target")
```

### BFI Only

```{r exp opin BFI results}
#removing na's for particular analysis for ED analysis
mod_opin_bfi_data <- clean_ptcheck %>% 
  select(sub_id, TargBFI, group_cond, selfBFI_c, opin_pol_combined) %>% 
  na.omit()

mod_opin_BFI <- lmer(TargBFI ~ group_cond*selfBFI_c*opin_pol_combined +
                        + (selfBFI_c|sub_id),
               data = mod_opin_bfi_data)

summary(mod_opin_BFI)
```

#### Plot ME Opinion

```{r exp opin plot BFI opin main}
ggplot(mod_opin_bfi_data, aes(selfBFI_c, 
                       TargBFI, 
                       group = opin_pol_combined, 
                       colour = opin_pol_combined)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = opin_pol_combined)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by voting opinion",
       subtitle = "Projection using BFI items",
       x = "BFI items for self",
       y = "BFI items for target")
```

## Political knowledge moderator

Does not appear to moderate projection, but does interact with stereotyping of the target.

### With stereotyping

```{r political knowledge mod with stereo}
knowledge_mod_data <- EDBFI_overall %>% 
  select(sub_id, Targ, stereo_c, group_cond, self_c, house_most_members) %>% 
  na.omit()

knowledge_mod <- lmer(Targ ~ stereo_c*group_cond*self_c*house_most_members + (self_c|sub_id),
               data = knowledge_mod_data)

summary(knowledge_mod)
```

### Without stereotyping

```{r political knowledge mod without stereo}
knowledge_mod_data <- EDBFI_overall %>% 
  select(sub_id, Targ, stereo_c, group_cond, self_c, house_most_members) %>% 
  na.omit()

knowledge_mod_nostereo <- lmer(Targ ~ group_cond*self_c*house_most_members + (self_c|sub_id),
               data = knowledge_mod_data)

summary(knowledge_mod_nostereo)
```
