---
title: "Counter Projection 4 Analyses"
author: "Kathryn Denning"
date: "1/20/2021"
output: 
    html_document:
      code_download: TRUE
      toc: TRUE
      toc_float:
        collapsed: FALSE
      toc_depth: 1
      code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r data prep, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Code to install packages if needed

#install.packages("car")
#install.packages("psych")
#install.packages("lmerTest")
#install.packages("data.table")
#install.packages("sjPlot")
#install.packages("effects")
#install.packages("Cairo")
#install.packages("tinytex")
#install.packages("magrittr")
#install.packages("parameters")
#install.packages("tidyverse")
#install.packages("rio")
#install.packages("nFactors")

# Loading packages
library(car)
library(psych)
library(lmerTest)
library(data.table)
library(sjPlot)
library(effects)
library(Cairo)
library(tinytex)
library(magrittr)
library(parameters)
library(tidyverse)
library(rio)
library(nFactors)

# Improves plots in Windows; This as well as the tinytex packages are not necessary for the rest of the code if run on Mac
knitr::opts_knit$set(dev.args = list(type = "cairo"))

# Setting global chunk options
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

options(scipen = 999)

# Importing data cleaned & saved in the "Data cleaning & exporting.R" doc
clean_ptcheck <- import("long_format.csv") 
```

```{r cleaning var types, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Cleaning variable types - this cleaning is not sustained when converted to a .csv and read back in
clean_ptcheck %<>% 
  mutate(sub_id = as.factor(sub_id),
         ED_number = as.numeric(ED_number),
         BFI_number = as.numeric(BFI_number),
         ED_targ_group = as.factor(ED_targ_group),
         BFI_target_group = as.factor(BFI_target_group),
         opin_pol_combined = as.factor(opin_pol_combined),
         race = as.factor(race),
         gender = as.factor(gender),
         education = as.factor(education),
         parent_education = as.factor(parent_education),
         country_birth = as.factor(country_birth),
         native_language = as.factor(native_language),
         citizen = as.factor(citizen),
         us_location = as.factor(us_location),
         group_cond = as.factor(group_cond),
         opin_pol_combined = dplyr::recode(opin_pol_combined,
                                    `1` = "Trump supporter",
                                    `2` = "Anti Trump")) %>% 
  mutate_if(is.integer,~as.numeric(.))
```

# Demographics & Descriptives {.tabset .tabset-fade .tabset-pills}

## Sample Size

### Overall:

```{r n}
clean_ptcheck %>% 
  select(sub_id) %>% 
  unique() %>% 
  nrow()
```

### N per In/out-group

```{r n by group cond}
clean_ptcheck %>% 
  select(sub_id, group_cond) %>% 
  unique() %>% 
  group_by(group_cond) %>% 
  count()

```

### N per Group & voting opinion

```{r n by group and voting opin}
clean_ptcheck %>% 
  select(sub_id, group_cond, opin_pol_combined) %>% 
  unique() %>% 
  group_by(group_cond, opin_pol_combined) %>% 
  count()
```

## Gender

```{r gender}
clean_ptcheck %>% 
  na.omit() %>% 
  select(sub_id, gender) %>% 
  mutate(gender = dplyr::recode(gender, 
                         `1` = "Male",
                         `2` = "Female",
                         `3` = "Other")) %>% 
  unique() %>% 
  group_by(gender) %>% 
  count()
```

## Race

```{r race}
race_counts <- clean_ptcheck %>% 
  select(sub_id, race) %>% 
  na.omit() %>% 
  mutate(race = dplyr::recode(race, 
                       `1` = "American Indian/Alaska Native",
                       `2` = "Asian",
                       `3` = "Black",
                       `4` = "Latinx",
                       `5` = "Middle Eastern/North African",
                       `6` = "Caucasian",
                       `7` = "Multiracial",
                       `8` = "Other")) %>% 
  unique() %>% 
  group_by(race) %>% 
  count()

race_counts %>% 
  mutate(n_total = sum(race_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Age

```{r age}
clean_ptcheck %>% 
  select(sub_id, age) %>% 
  na.omit() %>% 
  summarize(mean = mean(age),
            sd = sd(age))
```

## Education

```{r participant education}
edu_counts <- clean_ptcheck %>% 
  select(sub_id, education) %>% 
  na.omit() %>% 
  mutate(education = dplyr::recode(education,
                                     `1` = "Less than high school",
                                     `2` = "High school graduate",
                                     `3` = "Some college",
                                     `4` = "Associate's degree",
                                     `5` = "Bachelor's degree",
                                     `6` = "Some graduate school",
                                     `7` = "Master's degree",
                                     `8` = "Doctorate or Professional Degree")) %>% 
  unique() %>% 
  group_by(education) %>% 
  count()

edu_counts %>% 
  mutate(n_total = sum(edu_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Birth country

*All participants are US citizens.*

```{r birth country}
clean_ptcheck %>% 
  select(sub_id, country_birth) %>% 
  na.omit() %>% 
  mutate(country_birth = dplyr::recode(country_birth,
                                      `1` = "US born",
                                      `2` = "Foreign born")) %>% 
  unique() %>% 
  group_by(country_birth) %>% 
  count()
```

## Country raised in

```{r country raised}
clean_ptcheck %>% 
  select(sub_id, country_raised) %>% 
  na.omit() %>% 
  mutate(country_raised = dplyr::recode(country_raised,
                                      `1` = "US raised",
                                      `2` = "Foreign raised")) %>% 
  unique() %>% 
  group_by(country_raised) %>% 
  count()
```

## Native language

```{r native language}
clean_ptcheck %>% 
  select(sub_id, native_language) %>% 
  na.omit() %>% 
  mutate(native_language = dplyr::recode(native_language,
                                      `1` = "English",
                                      `2` = "Foreign language")) %>% 
  unique() %>% 
  group_by(native_language) %>% 
  count()
```

## Overall political beliefs

Question: *Overall, where would you place yourself, on the following scale of liberalism to conservatism? 1 indicates "Very liberal" and 5 indicates "Very conservative"*

### Across group:

```{r histo of overall political leanings}
hist_pol_overall <- clean_ptcheck %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall$poli_orient_1)
```

### In-group:

```{r histo of overall political leanings in-group}
hist_pol_overall_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_in$poli_orient_1)
```

### Out-group:

```{r histo of overall political leanings out-group}
hist_pol_overall_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_out$poli_orient_1)
```

### Trump supporters: 

```{r histo of overall political leanings Trump}
hist_pol_overall_trump <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Trump supporter") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_trump$poli_orient_1)
```

### Anti Trump supporters: 

```{r histo of overall political leanings anti Trump}
hist_pol_overall_anti <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Anti Trump") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_anti$poli_orient_1)
```

## Social political beliefs

Question: *In terms of social and cultural issues (e.g., abortion, separation of church and state, affirmative action), where would you place yourself on the following scale? 1 indicates "Very liberal" and 5 indicates "Very conservative"*

### Across group:

```{r histo of social political leanings}
hist_pol_social <- clean_ptcheck %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social$poli_orient_2)
```

### In-group:

```{r histo of social political leanings in-group}
hist_pol_social_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_in$poli_orient_2)
```

### Out-group:

```{r histo of social political leanings out-group}
hist_pol_social_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_out$poli_orient_2)
```

### Trump supporters: 

```{r histo of social political leanings Trump}
hist_pol_social_trump <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Trump supporter") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_trump$poli_orient_2)
```

### Anti Trump supporters: 

```{r histo of social political leanings anti Trump}
hist_pol_social_anti <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Anti Trump") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_anti$poli_orient_2)
```

## Economic political beliefs

Question: *In terms of economic issues (e.g., taxation, welfare, privatization of social security), where would you place yourself on the following scale? 1 indicates "Very liberal" and 5 indicates "Very conservative"*

### Across group:

```{r histo of econ political leanings}
hist_pol_econ <- clean_ptcheck %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ$poli_orient_3)
```

### In-group:

```{r histo of econ political leanings in-group}
hist_pol_econ_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_in$poli_orient_3)
```

### Out-group:

```{r histo of econ political leanings out-group}
hist_pol_econ_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_out$poli_orient_3)
```

### Trump supporters: 

```{r histo of econ political leanings Trump}
hist_pol_econ_trump <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Trump supporter") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_trump$poli_orient_3)
```

### Anti Trump supporters: 

```{r histo of econ political leanings anti Trump}
hist_pol_econ_anti <- clean_ptcheck %>% 
  filter(opin_pol_combined == "Anti Trump") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_anti$poli_orient_3)
```

## Political knowledge

Question: *Which party has the most members in the U.S. House of Representatives in Washington, D.C.?*

**This data was collected in October 2020, when the House was Democratic**

```{r house correct}
clean_ptcheck %>% 
  select(sub_id, house_most_members) %>% 
  na.omit() %>% 
  unique() %>% 
  mutate(house_most_members = dplyr::recode(house_most_members,
                                            `2` = "Democrat control",
                                            `6` = "Republican control",
                                            `3` = "Do not know")) %>% 
  group_by(house_most_members) %>% 
  count()
```

This question shows that 114 people answered incorrectly and 104 did not know. Political knowledge and extreme political beliefs (how liberal or conservative someone is) could impact results and could be used as an exploratory moderator.

## Scale Validity

### BFI

#### Extraversion

```{r extraversion alpha}
BFI_valid <- clean_ptcheck %>% 
  select(sub_id, selfBFI, BFI_number) %>% 
  unique() %>% 
  pivot_wider(names_from = BFI_number, values_from = selfBFI)

extraversion <- BFI_valid %>% 
  select(c("1", "6", "11"))
psych::alpha(extraversion)
```

#### Agreeablesness

```{r agreeableness alpha}
agreeable <- BFI_valid %>% 
  select(c("2", "7", "12"))
psych::alpha(agreeable)
```

#### Conscientiousness

```{r conscientiousness alpha}
conscientious <- BFI_valid %>% 
  select(c("3", "8", "13"))
psych::alpha(conscientious)
```

#### Negative Emotionality

```{r neg emo alpha}
neg_emo <- BFI_valid %>% 
  select(c("4", "9", "14"))
psych::alpha(neg_emo)
```

#### Open mindedness

```{r open minded alpha}
open_minded <- BFI_valid %>% 
  select(c("5", "10", "15"))
psych::alpha(open_minded)
```

#### Honesty/morality

```{r honesty morality alpha}
honest_moral <- BFI_valid %>% 
  select(c("16", "17", "18", "19"))
psych::alpha(honest_moral)
```

### ED scale

#### Correlation matrix
```{r ED alpha}
ED_alpha <- clean_ptcheck %>% 
  select(sub_id, selfED, ED_number) %>% 
  unique() %>% 
  pivot_wider(names_from = ED_number, values_from = selfED) %>% 
  select(-sub_id) %>% 
  na.omit()

cor(ED_alpha)
```

#### Alpha

```{r ED lpha}
psych::alpha(ED_alpha, check.keys=TRUE)
```

This is the alpha for the entire scale. We also conduct a factor analysis later and look at alphas for those latent factors below.

```{r impact of NA removal on overall data, include = FALSE}
clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined)  %>% 
  unique() %>% 
  count()

# how unique numbers of datapoints change when we remove na's in long-format
clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined)  %>% 
  na.omit() %>% 
  unique() %>% 
  count()

# We will remove per analysis in the overall data-set to avoid data removal of participants due to irrelevant variables having NAs that cause the removal
```

# Pre-reg Mod 1: Projection by group w/ BFI {.tabset .tabset-fade .tabset-pills}

## Model

```{r model 1 data}
# removing na's and repeat data due to long-format variables no longer included in this analysis
model1_data <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined) %>% 
  # changing the name in the model data-set so the function below will work the same for all models
  mutate(self_c = selfBFI_c) %>% 
  na.omit() %>% 
  unique()
```

### Effects coding contrasts

```{r}
contrasts(model1_data$group_cond) <- contr.sum(2)
contrasts(model1_data$group_cond)
```

### Results

```{r model 1 results}
model1 <- lmer(TargBFI ~ self_c*group_cond + (self_c|sub_id),
               data = model1_data)
summary(model1)
confint(model1)
```

## Plot


```{r function for group main effect plots}
##### Function to obtain and clean data from model & run base plot for ME group on projection #####
get_groupME_proj_plot <- function(x){
  effects_data <- effect(term = "self_c:group_cond", 
         xlevels = list(group_cond = c("In-group", "Out-group")), 
         mod = x)
  
  effects_data <- as.data.frame(effects_data)
  
  groupME_plot <- ggplot(effects_data, aes(self_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm"))
  
  return(groupME_plot)
}
```


```{r ME group model 1 plot}
model1_plot <- get_groupME_proj_plot(model1)

model1_plot + 
  labs(title = "Plot from Model 1: Main effect of target group on projection",
       subtitle = "Projection using BFI",
       x = "Personality responses for self",
       y = "Personality responses for target",
       linetype = "Group")

#Murat's alternative in interact plot if I want to use it in the future
#interactions::interact_plot(model1, pred = "self_c", modx = "group_cond", plot.points = F, interval = F)
```

We replicate our prior finding that people counter project with their political out-group, but project positively with their political in-group target.

This supports Confirmatory Prediction #1: *"People will counter-project to a target person from their political out-group and project to a target person from their in-group."*

# Hierarchical build-up to Pre-reg Mod 2 {.tabset .tabset-fade .tabset-pills}

```{r model 2 ED data}
model2ED_data <- clean_ptcheck %>% 
  select(sub_id, ED_number, TargED, selfED_c, group_cond, 
         opin_pol_combined, stereoED_c) %>% 
  # renaming for group ME function
  mutate(self_c = selfED_c) %>% 
  na.omit() %>% 
  unique()
```

### Effects codes applied to all data-sets

```{r}
contrasts(model2ED_data$group_cond) <- contr.sum(2)
contrasts(model2ED_data$group_cond)
```

## Everyday Likes (ED) w/o stereo model

### Results

```{r model 2 ED results not pre-reg}
model2ED_nostereo <- lmer(TargED ~ self_c*group_cond + (self_c|sub_id),
               data = model2ED_data)
summary(model2ED_nostereo)
confint(model2ED_nostereo)
```

### Plots

```{r model 2 ED plot main effect group}
model2group_plot_EDnostereo <- get_groupME_proj_plot(model2ED_nostereo)

model2group_plot_EDnostereo +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using 'Everyday Likes' (ED) items before stereotyping added",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Group")
```

Without stereotyping, we see even more extreme counter projection.

## ED w/ stereo model

### Results

```{r model 2 ED results}
model2EDwstereo <- lmer(TargED ~ self_c*group_cond*stereoED_c + (1|sub_id),
               data = model2ED_data)
summary(model2EDwstereo)
confint(model2EDwstereo)
```

Running Everyday Likes on its own with stereotyping (Model 2 pre-registered adding both ED and stereotyping at once) does not converge. Most likely due to too few items nested within the higher level for so many variables and not enough variance between the two.

We removed random slopes for the selfED_c predictor and then the model converged. To see if that patterns observed in this fixed effects model are reliable, we looked at the impact of removing random slopes for self in models for the everyday likes without stereotyping and BFI with stereotyping and found it did not have an impact on results, making us trust the patterns shown in this model.

### Plots

```{r model 2 ED plot main effect group with stereo}
model2group_plot_EDwstereo <- get_groupME_proj_plot(model2EDwstereo)

model2group_plot_EDwstereo +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using ED likes items controlling for stereotyping",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Group")
```

We still see counter projection, even when controlling for stereotyping.


## ED no cats/dogs 

```{r model 2 ED data no neg correlated item}
mod2_ED_nodogs <- clean_ptcheck %>% 
  select(sub_id, ED_number, TargED, selfED_c, group_cond, 
         opin_pol_combined, stereoED_c) %>% 
  # renaming for group ME function
  mutate(self_c = selfED_c) %>% 
  filter(ED_number != "3") %>% 
  na.omit() %>% 
  unique()
```

### Results without stereotyping

```{r model 2 ED results no neg correlated item no stereo}
model2ED_nodogsORstereo <- lmer(TargED ~ self_c*group_cond + (self_c|sub_id),
               data = mod2_ED_nodogs)
summary(model2ED_nodogsORstereo)
confint(model2ED_nodogsORstereo)
```

```{r model 2 ED no neg correlated item no stereo plot}
model2group_plot_EDnodogsORstereo <- get_groupME_proj_plot(model2ED_nodogsORstereo)

model2group_plot_EDnodogsORstereo +
  labs(title = "Model 2: Main effect of target group without negatively correlated item",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Group")
```

Does not impact counter projection results without stereotyping. Though the main effect of projection is now significant but the main effect of target group does not change.

### Results with stereotyping

```{r model 2 ED results no neg correlated item w stereo}
model2ED_nodogs_wstereo <- lmer(TargED ~ self_c*group_cond*stereoED_c + (self_c|sub_id),
               data = mod2_ED_nodogs)
summary(model2ED_nodogs_wstereo)
confint(model2ED_nodogs_wstereo)
```

```{r model 2 ED plot no neg correlated item w stereo}
model2group_plot_EDnodogs_wstereo <- get_groupME_proj_plot(model2ED_nodogs_wstereo)

model2group_plot_EDnodogs_wstereo +
  labs(title = "Model 2: Main effect of target group without negatively correlated item",
       subtitle = "Controlling for stereotyping",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Group")
```

Again, does not change the results.

## BFI w/ stereo model

```{r model 2 bfi stereo data}
model2_bfistereo <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined, stereoBFI_c) %>% 
  # changing name for plot function
  mutate(self_c = selfBFI_c) %>% 
  na.omit() %>% 
  unique()
```

```{r contrast codes model 2 bfi stereo, include = FALSE}
contrasts(model2_bfistereo$group_cond) <- contr.sum(2)
contrasts(model2_bfistereo$group_cond)
```

### Results

```{r model 2 bfi stereo results}
model2_bfistereo_resuts <- lmer(TargBFI ~ self_c*group_cond*stereoBFI_c + (self_c |sub_id), data = model2_bfistereo)

summary(model2_bfistereo_resuts)
confint(model2_bfistereo_resuts)
```

Model failed to converge when allowing stereotyping to have random slopes as well, so only included self as random slopes.

The main effect of selfBFI_c:group_cond did not disappear when including stereotyping as a moderator, replicating that aspect of the exploratory results from Study 1 (my FYP), and there was no interaction of stereotyping*target group on projection. However, there is a three-way interaction that we need to consider, and we need to consider how the plots look.

### Plots

```{r model 2 main effect group}
model2group_plot_bfistereo <- get_groupME_proj_plot(model2_bfistereo_resuts)

model2group_plot_bfistereo +
  labs(title = "Model 2: Main effect of target group on projection using BFI",
       subtitle = "Controlling for stereotyping",
       x = "Personality responses for self",
       y = "Personality responses for target",
       linetype = "Group")
```

When controlling for stereotyping, the counter projection found earlier does disappear. This is in contrast with the exploratory results of my FYP with MFQ.

```{r model 2 interaction with stereo prep}
describe(model2_bfistereo$stereoBFI_c)

model2_bfistereo_int_effects <- effect(term = "self_c:group_cond:stereoBFI_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"), 
                                         stereoBFI_c = c(-1.22, 0, 1.22)), 
                           mod = model2_bfistereo_resuts)

model2_bfistereo_int_effects <- as.data.frame(model2_bfistereo_int_effects)

model2_bfistereo_int_effects %<>% 
  mutate(Stereotyping = as.factor(stereoBFI_c),
         Stereotyping = dplyr::recode(Stereotyping,
                                      `-1.22` = 
                                        "Low stereotyping \n (1 SD below)",
                                      `0` = 
                                        "Average stereotyping",
                                      `1.22` = 
                                        "High stereotyping  \n(1 SD above)"))
```

```{r model 2 interaction plot with stereo}
ggplot(model2_bfistereo_int_effects, aes(self_c, 
                                     fit, 
                                     group = group_cond,
                                     colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_grid(cols = vars(Stereotyping)) +
  theme_minimal() +
  labs(title = "Model 2: Projection by stereotype use and group membership",
       subtitle = "Using BFI only - not explicitly pre-registered",
       x = "Personality traits for self",
       y = "Personality traits for target",
       linetype = "Group")
```

It appears that as stereotype use increases, the intercept for projection for both in-group and out-group increases and the difference between groups increases as well. People are projecting more for their in-group when they stereotype the least, but also appear to be projecting less with their out-group in that same condition, though the slopes for projection are much flatter. There are no flat or negative slopes for out-group projection in this plot. 

### Effects codes applied to all data-sets

```{r}
contrasts(model2ED_data$group_cond) <- contr.sum(2)
contrasts(model2ED_data$group_cond)
```

## BFI + ED w/o stereo model

```{r EDBFI data cleaning, include = FALSE}
EDBFI_overall <- clean_ptcheck %>% 
  # only keeping variables relevant to analyses that will follow in this doc
  select(sub_id, ED_number, BFI_target_group, TargED, selfED, group_cond, 
         opin_pol_combined, BFI_number, selfBFI, TargBFI, 
         stereoBFI, stereoED, identification, contentiousness, fundaMoral, 
         threat, lib, cons, house_most_members) %>% 
  # after getting rid of other variables, getting unique lines of code to get rid of repeat lines of code that came from long-format of other variables
  unique() %>%
  # renaming variables so that I can separate them in a useful way when using pivot
  rename(self_BFI = selfBFI,
         self_ED = selfED,
         Targ_ED = TargED,
         Targ_BFI = TargBFI,
         stereo_BFI = stereoBFI,
         stereo_ED = stereoED) %>% 
  # using pivot to combine BFI and ED into one column
  pivot_longer(c(self_BFI, self_ED, Targ_ED, Targ_BFI, stereo_BFI, stereo_ED),
               names_sep = "_",
               names_to = c("EDBFI_groups", "EDBFI_scale")) %>% 
  pivot_wider(names_from = EDBFI_groups, values_from = value) %>% 
  # changing the ED numbers to continue at the end of the BFI numbers so there is one column as a unique identifier for the order of items in the EDBFI variable
  mutate(ED_number = as.numeric(dplyr::recode(ED_number,
                                              `1` = "20",
                                              `2` = "21",
                                              `3` = "22",
                                              `4` = "23",
                                              `5` = "24")),
         # combining the number scales for BFI and ED into one
         EDBFI_number = ifelse(EDBFI_scale == "BFI", BFI_number,
                               ifelse(EDBFI_scale == "ED", ED_number, NA))) %>% 
  # dropping variables no longer needed after cleaning
  select(-c(ED_number, BFI_number, EDBFI_scale)) %>% 
  # getting rid of rows that became repeats through the wrangling
  unique() %>% 
  # mean centering continuous predictors for confirmatory analyses
  mutate(self_c = self - mean(self, na.rm = TRUE),
         stereo_c = stereo - mean(stereo, na.rm = TRUE),
         identification_c = identification - mean(identification, na.rm = TRUE))

# Making a data-set that doesn't have exploratory variables for confirmatory analyses to only remove NA's in confirmatory variables for these models to retain as much data as possible
EDBFI_mod2 <- EDBFI_overall %>% 
  select(-c(contentiousness, fundaMoral, 
            threat, lib, cons, house_most_members, 
            identification, identification_c)) %>% 
  na.omit()
```

```{r n EDBFI data, include = FALSE}
# no participants dropped from model 1 to model 2 for EDBFI
EDBFI_mod2 %>% 
  select(sub_id) %>% 
  unique() %>% 
  nrow()
```

```{r model 2 EDBFI contrasts, include = FALSE}
contrasts(EDBFI_mod2$group_cond) <- contr.sum(2)
contrasts(EDBFI_mod2$group_cond)
```

### Results

```{r model 2 EDBFI no stereo results}
model2EDBFI_nostereo <- lmer(Targ ~ self_c*group_cond + (self_c|sub_id),
               data = EDBFI_mod2)
summary(model2EDBFI_nostereo)
confint(model2EDBFI_nostereo)
```

### Plots

```{r model 2 EDBFI no stereo main effect group}
model2group_plot_EDBFI_nostereo <- get_groupME_proj_plot(model2EDBFI_nostereo)

model2group_plot_EDBFI_nostereo +
  labs(title = "Model 2: Main effect of target group on projection",
       subtitle = "Projection using 'Everyday Likes' + BFI items",
         x = "ED + BFI items for self",
         y = "ED + BFI items for target",
       linetype = "Group")
```

With everyday likes added to the BFI, the main effect of target group on projection does not change from Model 1 (there is still counter projection).

# Pre-reg Model 2: ED + BFI w/ stereotyping {.tabset .tabset-fade .tabset-pills}

**Added stereotyping and everyday likes to Model 1 to see if it adding it changed counter projection.**

## Results

```{r model 2 EDBFI stereo results}
model2EDBFI_stereo <- lmer(Targ ~ self_c*group_cond*stereo_c + (self_c|sub_id),
               data = EDBFI_mod2)

summary(model2EDBFI_stereo)
confint(model2EDBFI_stereo)
```

When stereotyping is added as a random slope, the model does not converge. Thus, we chose to only include self as a random slope.

When ED and BFI are combined, there is no significant three-way interaction with stereotyping, self, and group. With stereotyping included as a moderator, the effect of target group on projection is still significant. The effect of group on stereotyping is not significant, which relates to our Prediction #2, discussed with the plot.

## Plots

```{r model 2 EDBFI stereo plot}
mod2EDBFI_targ_stereo_effects <- effect(term = "group_cond:stereo_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group")), 
                           mod = model2EDBFI_stereo)

mod2EDBFI_targ_stereo_effects <- as.data.frame(mod2EDBFI_targ_stereo_effects)
```

```{r model 2 plot stereo EDBFI}
ggplot(mod2EDBFI_targ_stereo_effects, aes(stereo_c, fit, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal() +
  labs(title = "Pre-reg Model 2: NS Effect of target group on stereotyping",
       subtitle = "Higher correspondence between BFI + ED ratings indicates more stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member",
       linetype = "Group")
```

People stereotype their in-group and out-group to a similar extent, but the intercept differs. This does not support our Confirmatory Prediction #2: "People will stereotype the out-group target more than the in-group target due to out-group homogeneity."  

```{r model 2 EDBFI projection plot}
model2group_plot_EDBFI_stereo <- get_groupME_proj_plot(model2EDBFI_stereo)

model2group_plot_EDBFI_stereo +
  labs(title = "Pre-reg Model 2: Effect of target group on projection",
       subtitle = "Controlled for stereotyping",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for self",
       linetype = "Group") 
```

When everyday likes items are added to the BFI, even with stereotyping controlled for in the model, we see slight counter projection with the out-group target. This corresponds with Confirmatory Prediction #3: "even with stereotyping as a predictor, projection will still explain variance in ratings of the target, producing the significant main effect predicted above and no model singularities (in other words, how the participant rates the Self and the Stereotypical target will each predict unique variance in ratings of the target;  moreover, the model with both of predictors included will not be singular). Although stereotyping may interact with projection as well (we found this in an earlier study), we do not expect the projection-only effects to go away."

Interestingly, we did not find an interaction of stereotyping with projection in our confirmatory results. As demonstrated by our exploratory heirarchdal build-up models, counter projection is driven by ED when stereotyping is included in the model, as there does not appear to be a stereotype for ED like there is for BFI to moderate counter projection with BFI.

# Model 3: Identification as moderator {.tabset .tabset-fade .tabset-pills}

## Pre-registered Confirmatory Model

**Our pre-registered model used the BFI only, as we pre-registered we would use the BFI only if we found there were differences in the data-sets of the BFI and ED. We also pre-registered we would drop stereotyping to conserve power.**

### Data note:

```{r mod 3 data}
dataBFI_mod3  <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined, stereoBFI_c, identification_c) %>% 
  # changing name for plot function
  mutate(self_c = selfBFI_c) %>% 
  na.omit() %>% 
  unique()

dataBFI_mod3 %>% 
  select(sub_id) %>% 
  unique() %>% 
  nrow()
```

2 participants dropped due to missing data in identification.

### Results

```{r model 3 EDBFI no stereo results}
model3BFI_nostereo <- lmer(TargBFI ~ self_c*group_cond*identification_c + (self_c|sub_id),
               data = dataBFI_mod3)

summary(model3BFI_nostereo)
confint(model3BFI_nostereo)
```

The interaction of target group and identification on projection is significant. The main effect of target group is still significant. There is a marginal effect of identification on projection.

### Plots

```{r model 3 bfi no stereo group by ident plot prep}
describe(dataBFI_mod3$identification_c)

mod3BFInostereo_proj_ident_group_effects <- effect(term = "self_c:group_cond:identification_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"), 
                                         identification_c = c(-1.27, 0, 1.27)), 
                           mod = model3BFI_nostereo)

mod3BFInostereo_proj_ident_group_effects<- as.data.frame(mod3BFInostereo_proj_ident_group_effects)

mod3BFInostereo_proj_ident_group_effects %<>% 
  mutate(Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low identification \n (1 SD below)",
                                         `0` = "Average \n identification",
                                         `1.27` = "High identificaiton \n (1 SD above)"))
```

```{r model 3 bfi no stereo group by ident plot}
ggplot(mod3BFInostereo_proj_ident_group_effects, aes(self_c, 
                                     fit, 
                                     group = group_cond,
                                     colour = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black",
              aes(linetype = group_cond)) +
  facet_grid(cols = vars(Identification)) +
  theme_minimal() +
  labs(title = "Pre-reg Model 3: Projection by identification and group membership",
       subtitle = "Model only used BFI and stereotyping removed for power",
       x = "BFI for self",
       y = "BFI for target",
       linetype = "Group")
```

As identification increases, out-group counter projection increases as well as in-group projection.

```{r model 3 no stereo BFI main effect group plot}
mod3BFI_nostereo_proj_group_plot <- get_groupME_proj_plot(model3BFI_nostereo)

mod3BFI_nostereo_proj_group_plot +
  labs(title = "Model 3: Main effect of group on projection controlling for identification",
       subtitle = "Using BFI items when stereotyping removed",
         x = "BFI items for self",
         y = "BFI items for target",
         linetype = "Group")
```

Without stereotyping and only using BFI, we see counter projection for out-group targets and regular projection for in-group targets.

```{r model 3 no stereo BFI prep main effect ident}
mod3BFI_nostereo_proj_ident <- effect(term = "self_c:identification_c",
                           xlevels = list(identification_c = c(-1.27, 0, 1.27)), 
                           mod = model3BFI_nostereo)

mod3BFI_nostereo_proj_ident <- as.data.frame(mod3BFI_nostereo_proj_ident)

mod3BFI_nostereo_proj_ident %<>% 
  mutate(Identification = as.factor(identification_c))
```

```{r Model 3 no stereo EDBFI main effect ident plot}
ggplot(mod3BFI_nostereo_proj_ident, aes(self_c, fit, group = Identification)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = Identification)) +
  theme_minimal(base_size = 13) +
  labs(title = "Model 3: Main effect of identification on projection controlling for group",
       subtitle = "Using BFI items when stereotyping removed",
         x = "BFI items for self",
         y = "BFI items for target") +
  scale_linetype_manual("Identification", breaks = c(-1.27, 0, 1.27), 
                       labels = c("Low (1 SD below)", 
                                  "Average", 
                                  "High (1 SD above)"),
                       values = c("solid", 
                                   "twodash", 
                                   "dotted"))
```

On lower scores for BFI, there is less difference in projection between identification groups. As ED and BFI scores increase, you see more projection in high identifiers compared to average and then low identifiers.

## BFI w/ stereo

### Results

```{r model 3 BFI no stereo results}
model3BFI_stereo <- lmer(TargBFI ~ self_c*group_cond*stereoBFI_c*identification_c + (self_c|sub_id), data = dataBFI_mod3)

summary(model3BFI_stereo)
confint(model3BFI_stereo)
```

When BFI is added to a model controlled by stereotyping, the interaction between condition and identification on projection disappears. There is a significant main effect of identification on stereotyping as well as group on projection. In addition, there is a significant interaction of stereotyping and group on projection. There is also a marginal interaction of group and identification on stereotyping. 

### Plots

```{r model 3 BFI no stereo group projection plot}
mod3BFI_stereo_group_plot <- get_groupME_proj_plot(model3BFI_stereo)

mod3BFI_stereo_group_plot +
  labs(title = "Plot from Model 3: Effect of target group on projection",
       subtitle = "Controlled for stereotyping",
       y = "BFI ratings for target",
       x = "BFI ratings for stereotypical group member",
       linetype = "Group")
```

Projection main effect results are the same as the exploratory model from Model 2 of the BFI with stereotyping in which stereotyping removes counter projection with out-group targets.

```{r model 3 BFI stereo x ident x proj int prep}
describe(dataBFI_mod3$stereoBFI_c)
describe(dataBFI_mod3$identification_c)

mod3BFIstereo_3way_effects <- effect(term = "self_c:stereoBFI_c:identification_c", 
                           xlevels = list(identification_c = c(-1.27, 0, 1.27),
                                          stereoBFI_c = c(-1.22, 0, 1.22)), 
                           mod = model3BFI_stereo)

mod3BFIstereo_3way_effects <- as.data.frame(mod3BFIstereo_3way_effects)

mod3BFIstereo_3way_effects %<>% 
  mutate(Identification = as.factor(identification_c),
         Stereotyping = as.factor(stereoBFI_c),
         Stereotyping = dplyr::recode(Stereotyping,
                                      `-1.22` = "Low stereotyping \n (1 SD below)",
                                      `0` = "Average \n stereotyping",
                                      `1.22` = "High stereotyping \n (1 SD above")) 
```

```{r model 3 BFI stereo x ident x proj int plot}
ggplot(mod3BFIstereo_3way_effects, aes(self_c, 
                                      fit, 
                                      group = Identification, 
                                      colour = Identification)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Identification)) +
  facet_wrap(vars(Stereotyping)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Model 3: Projection predicted by stereotyping and identification",
       subtitle = "Projection using BFI items",
       x = "BFI items for self",
       y = "BFI items for target") +
    scale_linetype_manual("Identification", breaks = c(-1.27, 0, 1.27), 
                       labels = c("Low (1 SD below)", 
                                  "Average", 
                                  "High (1 SD above)"),
                       values = c("solid", 
                                   "twodash", 
                                   "dotted"))
```

Collapsed across target group, people who apply less stereotypes to the target project more as in-group identification increases. Interestingly, people who demonstrate high use of stereotypes to the target exhibit the opposite pattern: low in-group identifiers project the most and as in-group identification increases, projection decreases. Average stereotype users all project around the same amount.

```{r mod 3 stereo plot prep for stereo by ident}
mod3BFI_stereoME_ident <- effect(term = "stereoBFI_c:identification_c", 
                           xlevels = list(identification_c = c(-1.27, 0, 1.27)), 
                           mod = model3BFI_stereo)

mod3BFI_stereoME_ident <- as.data.frame(mod3BFI_stereoME_ident)

mod3BFI_stereoME_ident %<>% 
  mutate(Identification = as.factor(identification_c))
```

```{r mod 3 stereo plot for stereo by ident}
ggplot(mod3BFI_stereoME_ident, aes(stereoBFI_c, fit, group = Identification, colour = Identification)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Identification)) +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Stereotyping by identification",
       subtitle = "Using BFI items",
       x = "BFI items for stereotypical group",
       y = "BFI items for target") +
  theme_minimal() +
   scale_linetype_manual("Identification", breaks = c(-1.27, 0, 1.27), 
                       labels = c("Low (1 SD below)", 
                                  "Average", 
                                  "High (1 SD above)"),
                       values = c("solid", 
                                   "twodash", 
                                   "dotted"))
```

As identification increases, stereotyping increases.

```{r model 3 ED stereo x ident x group int prep}
mod3BFI_stereobygroupident <- effect(term = "group_cond:stereoBFI_c:identification_c", 
                           xlevels = list(identification_c = c(-1.27, 0, 1.27),
                                          group_cond = c("In-group", "Out-group")), 
                           mod = model3BFI_stereo)

mod3BFI_stereobygroupident <- as.data.frame(mod3BFI_stereobygroupident)

mod3BFI_stereobygroupident %<>% 
  mutate(Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low identification \n (1 SD below)",
                                         `0` = "Average \n identification",
                                         `1.27` = "High identification \n (1 SD above)")) 
```

```{r model 3 ED stereo x ident x group int plot}
ggplot(mod3BFI_stereobygroupident, aes(stereoBFI_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(Identification)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Marginal: Stereotyping by identification and group",
       subtitle = "Using BFI items",
       x = "BFI items for stereotypical group",
       y = "BFI items for target",
       linetype = "Group")
```

This effect was marginal and appears to be driven by differences in stereotyping in high identifiers between target groups, in which they stereotype their in-group more than their out-group.

## ED w/o stereo

```{r mod 3 data ED, include = FALSE}
dataED_mod3  <- clean_ptcheck %>% 
  select(sub_id, ED_number, BFI_target_group, TargED, selfED_c, group_cond, 
         opin_pol_combined, stereoED_c, identification_c) %>% 
  # changing name for plot function
  mutate(self_c = selfED_c) %>% 
  na.omit() %>% 
  unique()
```

### Results

```{r model 3 ED no stereo results}
model3ED_nostereo <- lmer(TargED ~ self_c*group_cond*identification_c + (self_c|sub_id),
               data = dataED_mod3)

summary(model3ED_nostereo)
confint(model3ED_nostereo)
```

When only using ED, the significant effect of group remains and there is a marginal interaction with identification.

### Plots

```{r model 3 ed no stereo group by ident plot prep}
describe(dataED_mod3$identification_c)

mod3EDnostereo_proj_ident_group_effects <- effect(term = "self_c:group_cond:identification_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"), 
                                         identification_c = c(-1.27, 0, 1.27)), 
                           mod = model3ED_nostereo)

mod3EDnostereo_proj_ident_group_effects<- as.data.frame(mod3EDnostereo_proj_ident_group_effects)

mod3EDnostereo_proj_ident_group_effects %<>% 
  mutate(Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                         `-1.27` = "Low identification \n (1 SD below)",
                                         `0` = "Average \n identification",
                                         `1.27` = "High identificaiton \n (1 SD above)"))
```

```{r model 3 ED no stereo group by ident plot}
ggplot(mod3EDnostereo_proj_ident_group_effects, aes(self_c, 
                                     fit, 
                                     group = group_cond,
                                     colour = group_cond)) +
  geom_smooth(method = "lm", 
              size = .7, 
              colour = "black",
              aes(linetype = group_cond,
                  min = lower,
                  max = upper),
              stat = "identity") +
  facet_grid(cols = vars(Identification)) +
  theme_minimal() +
  labs(title = "Model 3: Projection by identification and group membership",
       subtitle = "Model only used ED and stereotyping removed for power",
       x = "ED for self",
       y = "ED for target",
       linetype = "Group")
```

As identification increases, out-group counter projection increases slightly, but in-group projection increases more dramatically. This effect was marginal, as can be seen by confidence interval bars.

```{r model 3 no stereo ED main effect group plot}
mod3ED_nostereo_proj_group_plot <- get_groupME_proj_plot(model3ED_nostereo)

mod3ED_nostereo_proj_group_plot +
  labs(title = "Model 3: Main effect of group on projection controlling for identification",
       subtitle = "Using ED items when stereotyping removed",
         x = "ED items for self",
         y = "ED items for target",
         linetype = "Group")
```

Without stereotyping and only using ED, we see counter projection for out-group targets and regular projection for in-group targets.

## ED w/ stereo

```{r model 3 ED stereo results}
model3ED_stereo <- lmer(TargED ~ self_c*group_cond*identification_c*stereoED_c + (self_c|sub_id),
               data = dataED_mod3)

summary(model3ED_stereo)
confint(model3ED_stereo)
```

When including stereotyping, the main effect of group on projection is still significant, but the marginal interaction with identification disappears. 

Stereotyping interacts with projection with following variables:
 * Self, group, and stereo
 * Self, group, identification, and stereo

### Plots

```{r model 3 stereo ED main effect group plot}
mod3ED_stereo_proj_group_plot <- get_groupME_proj_plot(model3ED_stereo)

mod3ED_stereo_proj_group_plot +
  labs(title = "Model 3: Main effect of group on projection controlling for identification",
       subtitle = "Using ED items controlling for stereotyping",
         x = "ED items for self",
         y = "ED items for target",
         linetype = "Group")
```

As in Model 2, when adding stereotyping as a moderator, counter projection with out-groups is not reduced. Instead, projection with in-groups is reduced. Interestingly, with identification as a moderator, projection with in-group targets gains a slight negative slope as well.

```{r model 3 ED stereo x group x proj int prep}
describe(dataED_mod3$stereoED_c)

mod3EDstereo_3way_effects <- effect(term = "self_c:group_cond:stereoED_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"),
                                          stereoED_c = c(-1.04, 0, 1.04)), 
                           mod = model3ED_stereo)

mod3EDstereo_3way_effects <- as.data.frame(mod3EDstereo_3way_effects)

mod3EDstereo_3way_effects %<>% 
  mutate(Stereotyping = as.factor(stereoED_c),
         Stereotyping = dplyr::recode(Stereotyping,
                                      `-1.04` = "Low stereotyping \n (1 SD below)",
                                      `0` = "Average \n stereotyping",
                                      `1.04` = "High stereotyping \n (1 SD above")) 
```

```{r model 3 ED stereo x group x proj int plot}
ggplot(mod3EDstereo_3way_effects, aes(self_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(Stereotyping)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Model 3: Projection predicted by stereotyping and target group",
       subtitle = "Projection using ED items",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Group")
```

Counter projection with out-group targets using ED remains the same regardless of stereotype use. People who use large amounts of stereotypes, project positively with their in-group. As stereotype use decreases, in-group projection decreases, ultimately becoming counter projection with low stereotype users.

```{r model 3 ED stereo x group x proj x ident int prep}
describe(dataED_mod3$stereoED_c)
describe(dataED_mod3$identification_c)

mod3EDstereo_4way_effects <- effect(term = "self_c:group_cond:identification_c:stereoED_c", 
                           xlevels = list(group_cond = c("In-group", 
                                                         "Out-group"),
                                          stereoED_c = c(-1.04, 0, 1.04),
                                          identification_c = c(-1.28, 0 , 1.28)), 
                           mod = model3ED_stereo)

mod3EDstereo_4way_effects <- as.data.frame(mod3EDstereo_4way_effects)

mod3EDstereo_4way_effects %<>% 
  mutate(Stereotyping = as.factor(stereoED_c),
         Stereotyping = dplyr::recode(Stereotyping,
                                      `-1.04` = "Low stereotyping \n (1 SD below)",
                                      `0` = "Average \n stereotyping",
                                      `1.04` = "High stereotyping \n (1 SD above"),
         Identification = as.factor(identification_c),
         Identification = dplyr::recode(Identification,
                                        `-1.28` = "Low identification \n (1 SD below)",
                                        `0` = "Average \n identification",
                                        `1.28` = "High identification \n (1 SD above)")) 
```

```{r model 3 ED stereo x group x proj x ident int plot}
ggplot(mod3EDstereo_4way_effects, aes(self_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_grid(vars(Stereotyping), vars(Identification)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Model 3: Projection predicted by stereotyping and target group",
       subtitle = "Projection using ED items",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Group")
```

Counter projection with out-group targets is unaffected, the interaction is with in-group targets. Within low identifiers, as stereotype use increases, people go from counter projecting to projecting positively with their in-group. Average identifiers who are using little stereotypes do not counter project as much as low identifiers, though the slope only increases to become slightly positive as stereotype use increases among average identifiers. Among high identifiers, the pattern is opposite that of low identifiers: those who stereotype less project positively with their in-group, while, as stereotype use increases, positive projection disappears and becomes counter projection.

# Exp Model 4 from Pre-reg {.tabset .tabset-fade .tabset-pills}

## EFA

We decided to use only the ED data because we are assessing the impact of individual difference variables on counter projection, which we did not find with the BFI when controlled for stereotyping.

https://cran.r-project.org/web/packages/parameters/vignettes/efa_cfa.html

Missing data per individual difference variable:

```{r getting data for exploratory analsyses}
indivdiff_data <- clean_ptcheck %>%
  select(sub_id, TargED, selfED_c, stereoED_c, identification, identification_c,
         group_cond, lib, cons, contentiousness, threat, fundaMoral) %>% 
  mutate_at(vars(lib), ~replace(., is.na(.), 99)) %>% #to remove NA's using filtering, making them 99's first, since filter wasn't letting me filter "NA"
  filter(lib != "99") %>% 
  mutate(perceive_polar = abs(lib - cons),
         perceive_polar_c = perceive_polar - mean(perceive_polar, na.rm = TRUE),
         content_c = contentiousness - mean(contentiousness, na.rm = TRUE),
         threat_c = threat - mean(threat, na.rm = TRUE),
         fundaMoral_c = fundaMoral - mean(fundaMoral, na.rm = TRUE),
         self_c = selfED_c)#getting variable for perceived polar by subtracting perceived polarization for conservatives from liberals and getting teh absolute value of that diff

EFA <- indivdiff_data %>% 
  select(sub_id, identification, threat, perceive_polar, fundaMoral, contentiousness) %>% 
  unique() %>% 
  select(-sub_id)

# Not too much missing data, I think we should be okay on power
sapply(EFA, function(x) sum(is.na(x)))
```

### Exploratory N

```{r exploratory n}
indivdiff_data %>% 
  select(sub_id) %>% 
  unique() %>% 
  count()
```

### Can an EFA be run?

```{r EFA check}
# Check factor structure to see if there is enough correlation, etc. for factor analysis
check_factorstructure(EFA)
```

### What number of factors are advisable?

```{r EFA n factor check}
factors_exp <- n_factors(EFA)
factors_exp

summary(factors_exp)
```

The majority of tests suggest only 1 factor, followed by 2 or 4 latent factors. 2 latent factors may make more theoretical sense for so few variables, but we will look at all three options.

### 1 Factor EFA

```{r EFA 1 fac}
efa_1fac <- psych::fa(EFA, nfactors = 1) %>% 
  model_parameters(sort = TRUE, threshold = "max")
efa_1fac
```

### 2 Factor EFA

```{r EFA 2 fac}
efa_2fac <- psych::fa(EFA, nfactors = 2) %>% 
  model_parameters(sort = TRUE, threshold = "max")
efa_2fac
```

### 3 Factor EFA

```{r EFA 4 fac}
efa_4fac <- psych::fa(EFA, nfactors = 4) %>% 
  model_parameters(sort = TRUE, threshold = "max")
efa_4fac
```

The EFA with 2 factors explains more of the total variance of the original data (49%). The 4 factor then explained the next highest amount of total variance (42%). Our singly factor latent variable EFA explained only 33% of the total variance.

It appears that the 2 factor structure is our best structure. This structure combines all factors but contentiousness into one factor, leaving us with factor 1: group beliefs and factor 2: contentiousness. 

If we were to follow the 4 factor structure, only threat and contentiousness are combined into one factor, which I would label "aggression." Fundamental Morals, Identification, and Perceived Polarization all fall into unique factors in this EFA.

## Alpha comparisons

### 1 factor

For comparison to other alphas:

```{r alpha 1 factor}
psych::alpha(EFA)
```

This alpha is .6. The latent factors for our 2 factor and 4 factor would need to be better.

### 2 factor combined factor

```{r alpha 2 factor}
group_beliefs <- EFA %>% 
  select(c(identification, perceive_polar, fundaMoral, threat))

psych::alpha(group_beliefs)
```

### 4 factor combined factor

```{r check reliability before combining factors}
aggression <- EFA %>% 
  select(c(threat, contentiousness))

psych::alpha(aggression)
```

Interestingly, the two-factor structure does not contain the best (or acceptable) reliability. The group beliefs factor only reaches an alpha of .56. The aggression factor in the 4 factor latent structure EFA only reaches an alpha of .54. When all 5 are combined, they have an alpha of .6. The overall alpha showed that if perceived polarization is dropped, the other four variables would achieve an alpha of .69, which is the highest alpha out of all the combinations and the only one bordering on acceptable. Dropping identification - which we have already run in our confirmatory analysis - only gets an alpha of .57. Since we stated we would only combine into factors if over .8, which these are not, we will not be combining into factors based on these criteria. 

We did state that we would combined moderators that were correlated greater than .7 if the EFA and reliability plan failed. We will look into this next.

## Correlation matrix

```{r correlation matrix}
cor(EFA, method = "pearson", use = "complete.obs")
```

None of the variables are correlation over .7 (actually .52 is the highest), so we will use them all individually.

## Exploratory results

We only used everyday likes because it is the scale we consistently saw counter projection with out-group targets. As we are specifically interested in counter projection with out-group targets, which stereotyping did not impact with everyday likes, we ran these models without stereotyping.

```{r indiv data}
indivdiff_data <- indivdiff_data %>% 
  select(-perceive_polar, - contentiousness, -selfED_c,
         -lib, -cons, -fundaMoral, -threat, -identification) %>% 
  na.omit()

contrasts(indivdiff_data$group_cond) <- contr.sum(2)
contrasts(indivdiff_data$group_cond)
```

### Perceived polar model

```{r}
model4_polar <- lmer(TargED ~ group_cond*self_c*perceive_polar_c  +
                        + (self_c|sub_id),
               data = indivdiff_data)

summary(model4_polar)
confint(model4_polar)
```

#### Main effect

```{r model 4 perceived polarization ME prep}
describe(indivdiff_data$perceive_polar_c)

mod4_polar_ME_effects <- effect(term = "self_c:perceive_polar_c", 
                           xlevels = list(perceive_polar_c = c(-2.42, 0, 2.42)), 
                           mod = model4_polar)

mod4_polar_ME_effects <- as.data.frame(mod4_polar_ME_effects)

mod4_polar_ME_effects %<>% 
  mutate(Polarization = as.factor(perceive_polar_c),
         Polarization = dplyr::recode(Polarization,
                                         `-2.42` = "Low (1 SD below)",
                                         `0` = "Average",
                                         `2.42` = "High (1 SD above)")) 
```

```{r model 4 perceived polar ME plot}
ggplot(mod4_polar_ME_effects, aes(self_c, 
                                      fit, 
                                      group = Polarization, 
                                      colour = Polarization)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = Polarization)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by perceived polarization",
       subtitle = "Projection using ED items",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Polarization")
```

#### Group x Polarization Int Plot

```{r model 4 perceived polarization 3 way prep}
describe(indivdiff_data$perceive_polar_c)

mod4_polar_effects <- effect(term = "group_cond:self_c:perceive_polar_c", 
                           xlevels = list(perceive_polar_c = c(-2.42, 0, 2.42),
                                          group_cond = c("In-group", "Out-group")), 
                           mod = model4_polar)

mod4_polar_effects <- as.data.frame(mod4_polar_effects)

mod4_polar_effects %<>% 
  mutate(Polarization = as.factor(perceive_polar_c),
         Polarization = dplyr::recode(Polarization,
                                         `-2.42` = "Low polarization \n (1 SD below)",
                                         `0` = "Average \n polarization",
                                         `2.42` = "High polarization \n (1 SD above)")) 
```

```{r model 4 perceived polar 3 way plot}
ggplot(mod4_polar_effects, aes(self_c, 
                                      fit, 
                                      group = group_cond, 
                                      colour = group_cond)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = group_cond)) +
  facet_wrap(vars(Polarization)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm"),
        legend.title = element_blank()) +
  labs(title = "Model 4: Projection predicted by group and perceived polarization",
       subtitle = "Projection using ED items",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Group")
```

At low polarization, we see slight positive projection with the out-group. However, once people regard polarization as average, we see steep counter projection that increases with high polarization. In-group projection remains similar across polarization, with the only change being an increase in intercept. This effect is marginal with stereotyping included in the model.

### Threat model

```{r}
model4_threat <- lmer(TargED ~ group_cond*self_c*threat_c +
                        + (self_c|sub_id),
               data = indivdiff_data)

summary(model4_threat)
confint(model4_threat)
```

Threat does not moderate counter projection with everyday likes.

### Contentiousness model

```{r}
model4_content <- lmer(TargED ~ group_cond*self_c*content_c  +
                        + (self_c|sub_id),
               data = indivdiff_data)

summary(model4_content)
confint(model4_content)
```

Contentiousness does not moderate counter projection with everyday likes.

### Fundamental moral model

```{r}
model4_fundmoral <- lmer(TargED ~ group_cond*self_c*fundaMoral_c  +
                        + (self_c|sub_id),
               data = indivdiff_data)

summary(model4_fundmoral)
confint(model4_fundmoral)
```

Fundamental moral beliefs does not moderate counter projection with everyday likes.

# Other Exploratory Analyses {.tabset .tabset-fade .tabset-pills}

## Exp results w/ voting opinion

### ED + BFI Results

```{r exp opin EDBFI results}
mod_opin_EDBFI <- lmer(Targ ~ group_cond*self_c*opin_pol_combined +
                        + (self_c|sub_id),
               data = EDBFI_mod2)

summary(mod_opin_EDBFI)
```

#### Plot ME opinion

```{r exp opin plot EDBFI opin main}
ggplot(EDBFI_mod2, aes(self_c, 
                       Targ, 
                       group = opin_pol_combined, 
                       colour = opin_pol_combined)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = opin_pol_combined)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Model 4: Projection predicted by voting opinion",
       subtitle = "Projection using ED + BFI items",
       x = "ED + BFI items for self",
       y = "ED + BFI items for target",
       linetype = "Candidate Preference")
```

### ED Only

```{r exp opin ED results}
#removing na's for particular analysis for ED analysis
mod_opin_ed_data <- clean_ptcheck %>% 
  select(sub_id, TargED, group_cond, selfED_c, opin_pol_combined) %>% 
  na.omit()

mod_opin_ED <- lmer(TargED ~ group_cond*selfED_c*opin_pol_combined +
                        + (selfED_c|sub_id),
               data = mod_opin_ed_data)

summary(mod_opin_ED)
confint(mod_opin_ED)
```

#### Plot ME Opinion

```{r exp opin plot ED opin main}
ggplot(mod_opin_ed_data, aes(selfED_c, 
                       TargED, 
                       group = opin_pol_combined, 
                       colour = opin_pol_combined)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = opin_pol_combined)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Model 4: Projection predicted by voting opinion",
       subtitle = "Projection using ED items",
       x = "ED items for self",
       y = "ED items for target",
       linetype = "Candidate Preference")
```

### BFI Only

```{r exp opin BFI results}
#removing na's for particular analysis for ED analysis
mod_opin_bfi_data <- clean_ptcheck %>% 
  select(sub_id, TargBFI, group_cond, selfBFI_c, opin_pol_combined) %>% 
  na.omit()

mod_opin_BFI <- lmer(TargBFI ~ group_cond*selfBFI_c*opin_pol_combined +
                        + (selfBFI_c|sub_id),
               data = mod_opin_bfi_data)

summary(mod_opin_BFI)
```

#### Plot ME Opinion

```{r exp opin plot BFI opin main}
ggplot(mod_opin_bfi_data, aes(selfBFI_c, 
                       TargBFI, 
                       group = opin_pol_combined, 
                       colour = opin_pol_combined)) +
  geom_smooth(method = "lm", se = FALSE, size = .7, colour = "black",
              aes(linetype = opin_pol_combined)) +
  theme_minimal() +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Model 4: Projection predicted by voting opinion",
       subtitle = "Projection using BFI items",
       x = "BFI items for self",
       y = "BFI items for target",
       linetype = "Candidate Preference")
```

## Political knowledge moderator

Does not appear to moderate projection, but does interact with stereotyping of the target.

### With stereotyping

```{r political knowledge mod with stereo}
knowledge_mod_data <- EDBFI_overall %>% 
  select(sub_id, Targ, stereo_c, group_cond, self_c, house_most_members) %>% 
  na.omit() %>% 
  mutate(political_knowledge = as.factor(ifelse(house_most_members == 2, "Correct", 
                                      ifelse(house_most_members != 2, "Incorrect", NA))))

knowledge_mod <- lmer(Targ ~ self_c*group_cond*stereo_c*political_knowledge + (self_c|sub_id),
               data = knowledge_mod_data)

summary(knowledge_mod)
```

```{r pol know plot stereo}
pol_know_stereo_plot <- get_groupME_proj_plot(knowledge_mod)

pol_know_stereo_plot +
  labs(title = "Main effect of group on projection controlling for political knowledge",
       subtitle = "Stereotyping controlled for in this model",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member",
       linetype = "Group")
```

### Without stereotyping

```{r political knowledge mod without stereo}
knowledge_mod_data <- EDBFI_overall %>% 
  select(sub_id, Targ, stereo_c, group_cond, self_c, house_most_members) %>% 
  na.omit() %>% 
  mutate(political_knowledge = as.factor(ifelse(house_most_members == 2, "Correct", 
                                      ifelse(house_most_members != 2, "Incorrect", NA))))

knowledge_mod_nostereo <- lmer(Targ ~ self_c*group_cond*political_knowledge + (self_c|sub_id),
               data = knowledge_mod_data)

summary(knowledge_mod_nostereo)
```

```{r pol know plot no stereo}
pol_know_nostereo_plot <- get_groupME_proj_plot(knowledge_mod_nostereo)

pol_know_nostereo_plot +
  labs(title = "Main effect of group on projection controlling for political knowledge",
       subtitle = "Stereotyping not including in this model",
       y = "BFI + ED ratings for target",
       x = "BFI + ED ratings for stereotypical group member",
       linetype = "Group")
```
