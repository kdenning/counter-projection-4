---
title: "Counter Projection 4 Analyses"
author: "Kathryn Denning"
date: "1/20/2021"
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
editor_options: 
  chunk_output_type: console
---

652 participants originally collected from Prolific Academic
3 had empty data lines = 649 in imported dataset

```{r data prep, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
#loading packages
library(foreign)
library(reshape2)
library(tidyverse)
library(dplyr)
library(car)
library(haven)
library(psych)
library(lmerTest)
library(sjPlot)
library(reshape2)
library(data.table)
library(emmeans)
library(effects)
library(Cairo)
library(tinytex)

#making it round to three decimal places
options(scipen = 999)
knitr::opts_knit$set(dev.args = list(type = "cairo"))

#Setting global chunk options
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

#importing the data that has been reviewed for completion of PT task
wide_data <- Import("data_downloaded_January_20_2021.csv") 
```

```{r bot check, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Checking if there are any repeat IP addresses that need removed
bot_check  <- wide_data %>% 
  select(sub_id, IPAddress)

#identifying the repeat IP addresses
repeat_ips <- bot_check$IPAddress[duplicated(bot_check$IPAddress)]

# There are none - as expected using Prolific
```

```{r data cleaning}
clean_data <- wide_data %>% 
  # reverse coding items that need reverse coded
  mutate_at(c("selfBFI_1", "selfBFI_7", "selfBFI_3", "selfBFI_8",
              "selfBFI_14", "selfBFI_10", "selfBFI_17", "selfBFI_18",
              "SterBFIAnti_1", "SterBFIAnti_7", "SterBFIAnti_3",
              "SterBFIAnti_8", "SterBFIAnti_14", "SterBFIAnti_10",
              "SterBFIAnti_17", "SterBFIAnti_18", "SterBFITrump_1",
              "SterBFITrump_7", "SterBFITrump_3", "SterBFITrump_8",
              "SterBFITrump_14", "SterBFITrump_10", "SterBFITrump_17",
              "SterBFITrump_18", "TargBFITrump_1", "TargBFITrump_7",
              "TargBFITrump_3", "TargBFITrump_8", "TargBFITrump_14",
              "TargBFITrump_10", "TargBFITrump_17", "TargBFITrump_18",
              "TargBFIAnti_1", "TargBFIAnti_7", "TargBFIAnti_3", 
              "TargBFIAnti_8", "TargBFIAnti_14", "TargBFIAnti_10",
              "TargBFIAnti_17", "TargBFIAnti_18"), 
               list(~dplyr::recode(., `1`= 5, 
                                   `2`= 4, 
                                   `3` = 3, 
                                   `4` = 2, 
                                   `5` = 1))) %>% 
  # get their two chances to answer about their opinion in the same column
  pivot_longer(c(opin_pol, opin_pol2)) %>% 
  mutate(opin_pol_combined = value) %>% 
  dplyr::select(-value, -name) %>% 
  filter(!is.na(opin_pol_combined)) %>% 
  # get the BFI scores used for projection in long-format
  pivot_longer(c(SterBFIAnti_1:SterBFIAnti_19,
               SterBFITrump_1:SterBFITrump_19,
               TargBFITrump_1:TargBFITrump_19,
               TargBFIAnti_1:TargBFIAnti_19,
               selfBFI_1:selfBFI_19),
               names_sep = "_",
               names_to = c("bfi_type", "BFI_number")) %>% 
  pivot_wider(names_from = bfi_type, values_from = value) %>% 
  # wrangle to remove NA's from target, since participants only got one target
  pivot_longer(c(TargBFITrump, TargBFIAnti),
              names_to = "BFI_target_group") %>% 
  mutate_at(vars(value), ~replace(., is.na(.), 99)) %>% 
  filter(value != "99") %>% 
  rename(TargBFI = value) %>% 
  # create column for target group for BFI
  mutate(BFI_target_group = (dplyr::recode(BFI_target_group, `TargBFITrump`= "Trump", 
                                   `TargBFIAnti`= "Anti"))) %>% 
  # get everyday responses in long format
  pivot_longer(c(SterEDAnti_1:SterEDAnti_5,
               SterEDTrump_1:SterEDTrump_5,
               TargEDTrump_1:TargEDTrump_5,
               TargEDAnti_1:TargEDAnti_5,
               selfED_1:selfED_5),
               names_sep = "_",
               names_to = c("ed_type", "ED_number")) %>% 
  pivot_wider(names_from = ed_type, values_from = value) %>% 
  # also need to wrangle to remove NA's due to one target per participant
  pivot_longer(c(TargEDTrump, TargEDAnti),
               names_to = c("ED_targ_group")) %>% 
  mutate_at(vars(value), ~replace(., is.na(.), 99)) %>% 
  filter(value != "99") %>% 
  rename(TargED = value) %>% 
  # target per everyday responses and making variables factors or numeric
  mutate(ED_targ_group = (dplyr::recode(ED_targ_group, `TargEDTrump`= "Trump", 
                                   `TargEDAnti`= "Anti")),
         group_cond = as.factor(ifelse(opin_pol_combined == 1 
                             & BFI_target_group == "Trump", 
                             "In-group",
                             ifelse(opin_pol_combined == 2 
                                    & BFI_target_group == "Trump", 
                                    "Out-group",
                                    ifelse(opin_pol_combined == 1 
                                           & BFI_target_group == "Anti", 
                                           "Out-group",
                                           ifelse(opin_pol_combined == 2 
                                                  & BFI_target_group == "Anti", 
                                                  "In-group", NA))))),
         ED_number = as.numeric(ED_number),
         BFI_number = as.numeric(BFI_number),
         ED_targ_group = as.factor(ED_targ_group),
         BFI_target_group = as.factor(BFI_target_group),
         opin_pol_combined = as.factor(opin_pol_combined),
         race = as.factor(race),
         gender = as.factor(gender),
         education = as.factor(education),
         parent_education = as.factor(parent_education),
         country_birth = as.factor(country_birth),
         native_language = as.factor(native_language),
         citizen = as.factor(citizen),
         us_location = as.factor(us_location)) %>% 
  # dropping unnecessary text variables
  select(-c(day_nosupport_targ, day_support_trump_targ, gender_3_TEXT,
            race_8_TEXT, country_birth_2_TEXT, country_raised_2_TEXT,
            native_language_2_TEXT, IPAddress)) %>% 
  # making one variable for the following variables depending on which target participants saw for both BFI and ED
  mutate(stereoBFI = ifelse(BFI_target_group == "Trump", SterBFITrump,
                             ifelse(BFI_target_group == "Anti", SterBFIAnti, 
                                    NA)),
         stereoED = ifelse(ED_targ_group == "Trump", SterEDTrump,
                           ifelse(ED_targ_group == "Anti", SterEDAnti, NA)),
         contentiousness = ifelse(opin_pol_combined == 1, cont_pol_trump,
                                  ifelse(opin_pol_combined == 2, cont_pol_antitrump, NA)),
         fundaMoral = ifelse(opin_pol_combined == 1, fund_pol_trump,
                                  ifelse(opin_pol_combined == 2, fund_pol_antitrump, NA)),
         polar_lib = ifelse(opin_pol_combined == 1, lib_pol_trump_8,
                                  ifelse(opin_pol_combined == 2, lib_pol_antitrump_8, NA)),
         polar_cons = ifelse(opin_pol_combined == 1, cons_pol_antitrump_8,
                                  ifelse(opin_pol_combined == 2, cons_pol_antitrump_8, NA)),
         threat = ifelse(opin_pol_combined == 1, threat_pol_trump,
                                  ifelse(opin_pol_combined == 2, threat_pol_antitrump, NA)),
         identification = ifelse(opin_pol_combined == 1, ident_pol_trump,
                                  ifelse(opin_pol_combined == 2, ident_pol_antitrump, NA)),
         # making manipulation checks all have the same levels so they can be combined to avoid NA's and used to filter out participants; keeping participants who got either qcheck 1 or 2 for the same question right
         qcheck_bfi_anti_total = ifelse(qcheck_bfi_notsupport == 2, 1,
                                        ifelse(qcheck2_bfi_notsupport == 2, 1,
                                               ifelse(qcheck_bfi_notsupport == 1, 2, #recoding so 1 = include and 2 = exclude
                                                      ifelse(qcheck_bfi_notsupport == 3, 2, NA)))),
         qcheck_bfi_trump_total = ifelse(qcheck_bfi_trump == 1, 1,
                                         ifelse(qcheck2_bfi_trump == 1, 1,
                                                ifelse(qcheck_bfi_trump == 2, 2,
                                                       ifelse(qcheck_bfi_trump == 3, 2, NA)))),
         qcheck_targ_trump_total = ifelse(qcheck_targ_trump == 1, 1,
                                          ifelse(qcheck2_targ_trump == 1, 1,
                                                 ifelse(qcheck_targ_trump == 2, 2, NA))),
         qcheck_targ_anti_total = ifelse(qcheck_targ_nosupport == 2, 1, #recoding so 1 = include, 2 = exclude
                                         ifelse(qcheck2_targ_nosupport == 2, 1,
                                                ifelse(qcheck_targ_nosupport == 1, 2, NA)))) %>% 
  # dropping variables no longer needed after creating new variables above
  select(-c(cont_pol_trump, cont_pol_antitrump, fund_pol_trump, 
            fund_pol_antitrump, lib_pol_trump_8, lib_pol_antitrump_8,
            cons_pol_antitrump_8, cons_pol_antitrump_8, threat_pol_trump,
            threat_pol_antitrump, ident_pol_trump, ident_pol_antitrump, consent,
            qcheck_bfi_notsupport, qcheck2_bfi_notsupport, qcheck2_bfi_trump,
            qcheck_bfi_trump, qcheck_targ_trump, qcheck2_targ_trump,
            qcheck_targ_nosupport, qcheck2_targ_nosupport,
            opin_pol_lastchance, cons_pol_trump_8)) %>% 
  filter(qcheck_bfi_anti_total == 1) %>% # only keeping participants who got manipulation check for the bfi anti trump right
  filter(qcheck_bfi_trump_total == 1) %>% # same as above but for bfi supporting target
  # putting the qcheck for targets together to avoid NAs, removing NAs, then only keeping correct responses
  pivot_longer(c(qcheck_targ_trump_total, qcheck_targ_anti_total),
               names_to = c("qcheck_question")) %>% 
  mutate_at(vars(value), ~replace(., is.na(.), 99)) %>% 
  filter(value != "99") %>% 
  filter(value == 1) %>% 
  rename(qcheck_targ = value) %>% 
  filter(citizen == 1)  %>% # only keeping people who are US citizens
  mutate(perceive_polar = abs(polar_lib - polar_cons)) %>% #getting variable for perceived polar
  # centering predictors - will wait to center exploratory predictors until after EFA
  mutate(selfBFI_c = selfBFI - mean(selfBFI, na.rm = TRUE),
         selfED_c = selfED - mean(selfED, na.rm = TRUE),
         stereoBFI_c = stereoBFI - mean(stereoBFI, na.rm = TRUE),
         stereoED_c = stereoED - mean(stereoED, na.rm = TRUE),
         identification_c = identification - mean(identification, na.rm = TRUE))

#opin_pol: Do you support Trump? 1 = yes; 2 = no; same in follow-up question
# for qcheck not support bfi, 2 is correct; originally
# for qcheck for trump bfi, 1 is correct; originally
# for qcheck for trump targ, 1 is correct; originally
# for qcheck for anti targ, 2 is correct; originally

clean_ptcheck <- clean_data %>% 
  filter(questionable_pt == 1) # only keeping people who completed the PT task correctly
```

# Demographics

## Sample Size

```{r n}
clean_ptcheck %>% 
  select(sub_id) %>% 
  unique() %>% 
  nrow()
```

## N per conditions

### In/out-group only

```{r n by group cond}
clean_ptcheck %>% 
  select(sub_id, group_cond) %>% 
  unique() %>% 
  group_by(group_cond) %>% 
  count()

```

### In/out-group & voting opinion

```{r n by group and voting opin}
clean_ptcheck %>% 
  select(sub_id, group_cond, opin_pol_combined) %>% 
  unique() %>% 
  mutate(opin_pol_combined = dplyr::recode(opin_pol_combined,
                                    `1` = "Trump supporter",
                                    `2` = "Anti Trump")) %>% 
  group_by(group_cond, opin_pol_combined) %>% 
  count()
```

## Gender

```{r gender}
clean_ptcheck %>% 
  na.omit() %>% 
  select(sub_id, gender) %>% 
  mutate(gender = dplyr::recode(gender, 
                         `1` = "Male",
                         `2` = "Female",
                         `3` = "Other")) %>% 
  unique() %>% 
  group_by(gender) %>% 
  count()
```

## Race

```{r race}
race_counts <- clean_ptcheck %>% 
  select(sub_id, race) %>% 
  na.omit() %>% 
  mutate(race = dplyr::recode(race, 
                       `1` = "American Indian/Alaska Native",
                       `2` = "Asian",
                       `3` = "Black",
                       `4` = "Latinx",
                       `5` = "Middle Eastern/North African",
                       `6` = "Caucasian",
                       `7` = "Multiracial",
                       `8` = "Other")) %>% 
  unique() %>% 
  group_by(race) %>% 
  count()

race_counts %>% 
  mutate(n_total = sum(race_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Age

```{r age}
clean_ptcheck %>% 
  select(sub_id, age) %>% 
  na.omit() %>% 
  summarize(mean = mean(age),
            sd = sd(age))
```

## Education

```{r participant education}
edu_counts <- clean_ptcheck %>% 
  select(sub_id, education) %>% 
  na.omit() %>% 
  mutate(education = dplyr::recode(education,
                                     `1` = "Less than high school",
                                     `2` = "High school graduate",
                                     `3` = "Some college",
                                     `4` = "Associate's degree",
                                     `5` = "Bachelor's degree",
                                     `6` = "Some graduate school",
                                     `7` = "Master's degree",
                                     `8` = "Doctorate or Professional Degree")) %>% 
  unique() %>% 
  group_by(education) %>% 
  count()

edu_counts %>% 
  mutate(n_total = sum(edu_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Parent Education

```{r parent education}
pedu_counts <- clean_ptcheck %>% 
  select(sub_id, parent_education) %>% 
  na.omit() %>% 
  mutate(education = dplyr::recode(parent_education,
                                     `20` = "Less than high school",
                                     `21` = "High school graduate",
                                     `22` = "Some college",
                                     `23` = "Associate's degree",
                                     `24` = "Bachelor's degree",
                                     `26` = "Some graduate school",
                                     `1` = "Master's degree",
                                     `2` = "Doctorate or Professional Degree")) %>% 
  unique() %>% 
  group_by(education) %>% 
  count()

pedu_counts %>% 
  mutate(n_total = sum(edu_counts$n),
    percent = n/n_total*100) %>% 
  select(-n_total)
```

## Birth country

*All participants are US citizens.*

```{r birth country}
# All are US citizens in this current study
clean_ptcheck %>% 
  select(sub_id, country_birth) %>% 
  na.omit() %>% 
  mutate(country_birth = dplyr::recode(country_birth,
                                      `1` = "US born",
                                      `2` = "Foreign born")) %>% 
  unique() %>% 
  group_by(country_birth) %>% 
  count()
```

## Country raised in

```{r country raised}
# All are US citizens in this current study
clean_ptcheck %>% 
  select(sub_id, country_raised) %>% 
  na.omit() %>% 
  mutate(country_raised = dplyr::recode(country_raised,
                                      `1` = "US raised",
                                      `2` = "Foreign raised")) %>% 
  unique() %>% 
  group_by(country_raised) %>% 
  count()
```

## Native language

```{r native language}
# All are US citizens in this current study
clean_ptcheck %>% 
  select(sub_id, native_language) %>% 
  na.omit() %>% 
  mutate(native_language = dplyr::recode(native_language,
                                      `1` = "English",
                                      `2` = "Foreign language")) %>% 
  unique() %>% 
  group_by(native_language) %>% 
  count()
```

## Overall political leaning

Question: Overall, where would you place yourself, on the following scale of liberalism to conservatism?
1 indicates "Very liberal" and 5 indicates "Very conservative"

### Across condition:

```{r histo of overall political leanings}
hist_pol_overall <- clean_ptcheck %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall$poli_orient_1)
```

### In-group condition:

```{r histo of overall political leanings in-group}
hist_pol_overall_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_in$poli_orient_1)
```

### Out-group condition:

```{r histo of overall political leanings out-group}
hist_pol_overall_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_1) %>% 
  unique()

hist(hist_pol_overall_out$poli_orient_1)
```

## Social political leaning

Question: In terms of social and cultural issues (e.g., abortion, separation of church and state, affirmative action), where would you place yourself on the following scale? 
1 indicates "Very liberal" and 5 indicates "Very conservative"

### Across condition:

```{r histo of social political leanings}
hist_pol_social <- clean_ptcheck %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social$poli_orient_2)
```

### In-group condition:

```{r histo of social political leanings in-group}
hist_pol_social_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_in$poli_orient_2)
```

### Out-group condition:

```{r histo of social political leanings out-group}
hist_pol_social_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_2) %>% 
  unique()

hist(hist_pol_social_out$poli_orient_2)
```

## Economic political leaning

Question: In terms of economic issues (e.g., taxation, welfare, privatization of social security), where would you place yourself on the following scale? 
1 indicates "Very liberal" and 5 indicates "Very conservative"

### Across condition:

```{r histo of econ political leanings}
hist_pol_econ <- clean_ptcheck %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ$poli_orient_3)
```

### In-group condition:

```{r histo of econ political leanings in-group}
hist_pol_econ_in <- clean_ptcheck %>% 
  filter(group_cond == "In-group") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_in$poli_orient_3)
```

### Out-group condition:

```{r histo of econ political leanings out-group}
hist_pol_econ_out <- clean_ptcheck %>% 
  filter(group_cond == "Out-group") %>% 
  select(sub_id, poli_orient_3) %>% 
  unique()

hist(hist_pol_econ_out$poli_orient_3)
```

## House control knowledge

Question: Which party has the most members in the U.S. House of Representatives in Washington, D.C.?

*This data was collected in October 2020, when the House was Democratic*

```{r house correct}
clean_ptcheck %>% 
  select(sub_id, house_most_members) %>% 
  na.omit() %>% 
  unique() %>% 
  mutate(house_most_members = dplyr::recode(house_most_members,
                                            `2` = "Democrat control",
                                            `6` = "Republican control",
                                            `3` = "Do not know")) %>% 
  group_by(house_most_members) %>% 
  count()
```

This question shows that 114 people answered incorrectly and 104 did not know. Political knowledge and extreme political beliefs (how liberal or conservative someone is) could impact results and could be used as an exploratory moderator.

```{r}
clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined)  %>% 
  unique() %>% 
  count()

# how unique numbers of datapoints change when we remove na's in long-format
clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined)  %>% 
  na.omit() %>% 
  unique() %>% 
  count()
```

# Pre-registered Model 1: Projection predicted by group

```{r model 1}
model1_data <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined) %>% 
  na.omit() %>% 
  unique()

model1 <- lmer(TargBFI ~ selfBFI_c*group_cond + (selfBFI_c|sub_id),
               data = model1_data)
summary(model1)
```

```{r Model 1 interaction plot}
ggplot(clean_ptcheck, aes(selfBFI_c, TargBFI, group = group_cond)) +
  geom_smooth(method = "lm", 
              se = FALSE, 
              size = .7, 
              colour = "black", 
              aes(linetype = group_cond)) +
  theme_minimal(base_size = 13) +
  theme(legend.key.size = unit(1, "cm")) +
  labs(title = "Main effect of target group on projection",
         x = "Personality responses for self",
         y = "Personality responses for target") +
  theme(legend.title = element_blank())
```

We replicate our prior finding that people counter project with their political out-group, but project positively with their political in-group target.

# Pre-registered Model 2: Stereotyping as outcome

# Pre-registered Model 3: Stereotyping as moderator

```{r model 3}
model3_data <- clean_ptcheck %>% 
  select(sub_id, BFI_number, BFI_target_group, TargBFI, selfBFI_c, group_cond, 
         opin_pol_combined, stereoBFI_c) %>% 
  na.omit() %>% 
  unique()

model3 <- lmer(TargBFI ~ selfBFI_c*group_cond*stereoBFI_c + (selfBFI_c|sub_id),
               data = model3_data)
summary(model3)
```

The main effect of selfBFI_c:group_condOut-group did not disappear when including stereotyping as a moderator, replicating the exploratory results from Study 1 (my FYP), and there was no interaction of stereotyping*target group on projection. However, there is a three-way interaction that we need to consider. Lets look at plots below of the three-way interaction.



*Added to Model 1*

# Pre-registered Model 4: In-group identification as moderator

*Added to Model 1*

